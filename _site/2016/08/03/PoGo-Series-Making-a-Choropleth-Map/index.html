<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      PoGo Series&#58; Making a Choropleth Map &middot; Dealing Data
    
  </title>

  <!-- Sidebar Icon Links-->
  <link rel="stylesheet" href="/fonts/font-awesome/css/font-awesome.min.css"> 
  <link rel="stylesheet" href="/fonts/cvFonts/styles.css"> 
  

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-81371278-1', 'auto');
  ga('send', 'pageview');

</script>

  <body>

    <div class="sidebar">
    <div class="sidebar-about">
      <h1>
          Dealing Data
      </h1>
    </div>

    <div class="sidebar-item">
      <p>A blog dedicated to learning data science techniques by applying them to real world data.</p>
    </div>


    <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/archive/">Archive</a>
          
        
      
        
      
        
          
        
      

      <!-- <a class="sidebar-nav-item" href=" http://www.github.com/raknoche ">GitHub Repo</a> -->
      <!-- <span class="sidebar-nav-item">Currently v1.0.0</span> -->

    <link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
  #mc_embed_signup{background:#202020; clear:left; font:14px Helvetica,Arial,sans-serif; }
  /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
     We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="//dealingdata.us13.list-manage.com/subscribe/post?u=194dacfdd7036fb11766517ff&amp;id=c0d39c54f6" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
  <h2 class="subscribe">Subscribe to our mailing list</h2>
<div class="mc-field-group">
  <label for="mce-EMAIL">Email Address </label>
  <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
</div>
  <div id="mce-responses" class="clear">
    <div class="response" id="mce-error-response" style="display:none"></div>
    <div class="response" id="mce-success-response" style="display:none"></div>
  </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_194dacfdd7036fb11766517ff_c0d39c54f6" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button" style="color: #202020"></div>
  </div>
</form>
</div>

    </nav>

    <!-- <p>&copy; 2016. All rights reserved.</p> -->
    <div class="sidebar-item">
     <p class="social-icons">
       <a href="https://github.com/raknoche"><i class="fa fa-github fa-2x"></i></a>
       <a href="https://www.linkedin.com/in/richard-knoche-ba8bb1122"><i class="fa fa-linkedin fa-2x"></i></a>
       <a href="mailto:raknoche@dealingdata.net"><i class="fa fa-envelope fa-2x"></i></a>
       <a href="https://github.com/Raknoche/CV_and_Resume/blob/master/CV/RichardKnoche_CV.pdf"><i class="icon-roundcv fa-2x"></i></a>
      
     </p>
     <p>
       &copy; 2016. All rights reserved.
     </p>
   </div>
</div>



    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container-mast">
          <h3 class="masthead-title">
            <a href="/" title="Home">Dealing Data</a>
            <small>Learning data science through example</small>
          </h3>
        </div>
      </div>
      
      <div class="container content">
        <div class="post">
  <h1 class="post-title">PoGo Series&#58; Making a Choropleth Map</h1>
  <span class="post-date">03 Aug 2016</span>
  
    

<p>TABLE OF CONTENTS</p>

<p>Welcome to the final post in our Pokemon Go analysis series.  Last time, we cleaned up our tweet collection before counting tweets from each Pokemon Go team in every state.  We used the fraction of tweets about a particular team as a measure of the dominance of that team in the state, and performed a statistical analysis to account for errors in our measurement.  In this post, we’ll use Python’s <code class="highlighter-rouge">Bokeh</code> and <code class="highlighter-rouge">Basemap</code> libraries to visualize our results in a <a href="http://www.datavizcatalogue.com/methods/choropleth.html">Choropleth map</a>.</p>

<p>We’ll cover the following topics:</p>

<ol>
  <li><a href="#loading">Loading the data</a></li>
  <li><a href="#ryb">Converting RYB fractions to RGB colors</a></li>
  <li><a href="#bokeh">Making an interactive Choropleth map with Bokeh</a></li>
  <li><a href="#basemap">Making a Basemap Colored by Prominent Team</a></li>
</ol>

<h1 id="a-nameloadinga-loading-the-data"><a name="loading"></a> Loading the data</h1>

<p>Before we begin, we’ll need to load the data analysis results from our previous post.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Import Pandas library</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="c">#Load the full collection of PoGo tweets</span>
<span class="n">stateInfo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'stateInfo.csv'</span><span class="p">)</span>
<span class="n">stateInfo_nosenti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'stateInfo_nosenti.csv'</span><span class="p">)</span>

<span class="n">stateInfo</span> <span class="o">=</span> <span class="n">stateInfo</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s">'State'</span><span class="p">])</span>
<span class="n">stateInfo_nosenti</span> <span class="o">=</span> <span class="n">stateInfo_nosenti</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s">'State'</span><span class="p">])</span>

<span class="n">stateInfo</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>/Users/richardknoche/anaconda/lib/python3.5/site-packages/matplotlib/__init__.py:1035: UserWarning: Duplicate key in file "/Users/richardknoche/.matplotlib/matplotlibrc", line #2
  (fname, cnt))
</code></pre>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Num Tweets</th>
      <th>Num Red</th>
      <th>Num Blue</th>
      <th>Num Yellow</th>
      <th>R Frac</th>
      <th>Y Frac</th>
      <th>B Frac</th>
      <th>R Frac Err</th>
      <th>Y Frac Err</th>
      <th>B Frac Err</th>
      <th>Average Rel Err</th>
      <th>Improved</th>
    </tr>
    <tr>
      <th>State</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Pennsylvania</th>
      <td>275</td>
      <td>111</td>
      <td>97</td>
      <td>67</td>
      <td>0.403636</td>
      <td>0.243636</td>
      <td>0.352727</td>
      <td>0.030429</td>
      <td>0.026448</td>
      <td>0.029600</td>
      <td>0.089287</td>
      <td>True</td>
    </tr>
    <tr>
      <th>Delaware</th>
      <td>27</td>
      <td>13</td>
      <td>7</td>
      <td>7</td>
      <td>0.481481</td>
      <td>0.259259</td>
      <td>0.259259</td>
      <td>0.096439</td>
      <td>0.084531</td>
      <td>0.084531</td>
      <td>0.284132</td>
      <td>False</td>
    </tr>
    <tr>
      <th>Nebraska</th>
      <td>64</td>
      <td>26</td>
      <td>23</td>
      <td>15</td>
      <td>0.406250</td>
      <td>0.234375</td>
      <td>0.359375</td>
      <td>0.061806</td>
      <td>0.053213</td>
      <td>0.060367</td>
      <td>0.182386</td>
      <td>False</td>
    </tr>
    <tr>
      <th>Michigan</th>
      <td>324</td>
      <td>123</td>
      <td>115</td>
      <td>86</td>
      <td>0.379630</td>
      <td>0.265432</td>
      <td>0.354938</td>
      <td>0.027841</td>
      <td>0.025192</td>
      <td>0.027430</td>
      <td>0.081843</td>
      <td>True</td>
    </tr>
    <tr>
      <th>Idaho</th>
      <td>27</td>
      <td>11</td>
      <td>9</td>
      <td>7</td>
      <td>0.407407</td>
      <td>0.259259</td>
      <td>0.333333</td>
      <td>0.094828</td>
      <td>0.084526</td>
      <td>0.090961</td>
      <td>0.277224</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>

<h1 id="a-nameryba-converting-ryb-fractions-to-rgb-colors"><a name="ryb"></a> Converting RYB fractions to RGB colors</h1>

<p>A <a href="http://www.datavizcatalogue.com/methods/choropleth.html">Choropleth map</a> divides geographic areas into distinct regions, and colors those regions to visualize patterns in your data.  We can apply this technique to our data to visualize the dominance of each Pokemon Go team in each state.  We’ll begin with a map of the United States, with boundaries drawn at the state level.  The fraction of tweets referencing each team in a particular state will tell us how much red, yellow, and blue (RYB) to mix into the color of that state.  For instance, if a particular state has an equal number of blue and yellow team tweets, but no red team tweets, we’d like to color that state green.</p>

<p>Conventionally, colors are defined on a red, green, and blue (RGB) colorscale.  We need a way to convert our RYB measurements into an RGB measurement.  I modified a <a href="http://vis.computer.org/vis2004/DVD/infovis/papers/gossett.pdf">trilinear interpolation method from Gossett and Chen</a> for this purpose.  The method requires us to construct a cube of colors on an RYB coordinate system.  The color red would appear at the coordinates (1,0,0) while the color yellow would appear at the coordinates (0,1,0) in this such a system.  Next, we must explicitly map the RYB colors to an RGB basis.  In the case of yellow, the point (0,1,0) in the RYB basis would map to the point (1,1,0) in the RGB basis, since red and green mix to make yellow.  Once we’ve done this for each point on our cube, we can use a <a href="https://en.wikipedia.org/wiki/Trilinear_interpolation">trilinear interpolation</a> of the RYB to RGB cube mapping to convert any RYB coordinate to the RGB basis.  The code for doing so is included below:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">RYB_to_RGB</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">b</span><span class="p">):</span> 

    <span class="c">#Define RYB vectors for each RGB color</span>
    <span class="n">f000</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">f001</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">f010</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">f011</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">f100</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">f101</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">f110</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.647</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">f111</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="c">#Define trilinear interpolation of RYB colors to RGB basis</span>
    <span class="n">rgb</span><span class="o">=</span><span class="n">f000</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span>\
        <span class="n">f001</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">b</span> <span class="o">+</span>\
        <span class="n">f010</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span>\
        <span class="n">f100</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span>\
        <span class="n">f011</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">b</span> <span class="o">+</span> \
        <span class="n">f101</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">b</span> <span class="o">+</span> \
        <span class="n">f110</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> \
        <span class="n">f111</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">b</span>
    
    <span class="k">return</span> <span class="n">rgb</span>
</code></pre>
</div>

<p>We’ll need a legend that indicates what each color on our Choropleth map means.  Imagine a triangle whose center lies at the origin of a coordinate system.  The top of the triangle, at $\left(x=1,y=0\right)$, can represent the red color of our map when we only have Team Valor tweets.  The bottom left of the triangle, at $\left(x=\frac{-\sqrt{3}}{2}, y=\frac{-1}{2}\right)$, can represent the yellow color of our map when we only have Team Instinct tweets.  The bottom right of the triangle, at $\left(x=\frac{\sqrt{3}}{2}, y=\frac{-1}{2}\right)$, can represent the blue color of our map when we only have Team Mystic tweets.  To fill in the rest of the triangle, we loop through each possible combination of red team, yellow team, and blue team fractions.  We determine the x and y coordinate of each combination by treating the individual red, yellow, and blue components as a vector and adding the individual vector coordinates together.  We then use our <code class="highlighter-rouge">RYB_to_RGB</code> function to determine the RGB color of those coordinates.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="c">#Create an empty canvas to color in</span>
<span class="c">#Canvas has 2000x2000 pixels, with additional 400 pixels of padding for some labels</span>
<span class="n">pixel_num</span><span class="o">=</span><span class="mi">2000</span>
<span class="n">word_padding</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">color_map</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">pixel_num</span><span class="p">,</span><span class="n">pixel_num</span><span class="o">+</span><span class="n">word_padding</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span> <span class="c">#Num xbins, Num Ybins, pixel RGBA</span>

<span class="c">#Loop through each red, yellow, blue fraction combination</span>
<span class="c">#Note the constraint r_level+y_level+b_level = 1</span>
<span class="k">for</span> <span class="n">r_level</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.0002</span><span class="p">):</span>
    <span class="n">y_max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">r_level</span>
    <span class="k">for</span> <span class="n">y_level</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">y_max</span><span class="p">,</span><span class="mf">0.0002</span><span class="p">):</span>
        <span class="n">b_level</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">r_level</span><span class="o">-</span><span class="n">y_level</span>
        
        <span class="c">#Determine RGB color for the RYB combination</span>
        <span class="n">rgb</span><span class="o">=</span><span class="n">RYB_to_RGB</span><span class="p">(</span><span class="n">r_level</span><span class="p">,</span><span class="n">y_level</span><span class="p">,</span><span class="n">b_level</span><span class="p">)</span>

        <span class="c">#Define x,y coordinate of the RGB value</span>
        <span class="n">x_coord</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_level</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">y_level</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">y_coord</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_level</span><span class="o">*</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y_level</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">b_level</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        
        <span class="c">#To convert the triangle y_coord to a canvas coord:</span>
        <span class="c">#Multiply `y_coord` by `pixel_num/2` to take up all pixels in our canvas. </span>
        <span class="n">canvas_y_coord</span> <span class="o">=</span> <span class="n">y_coord</span><span class="o">*</span><span class="p">(</span><span class="n">pixel_num</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c">#Shift everything up by pixel_num/2 to put y=1 at the top of our canvas.</span>
        <span class="n">canvas_y_coord</span> <span class="o">=</span> <span class="n">canvas_y_coord</span> <span class="o">+</span> <span class="p">(</span><span class="n">pixel_num</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c">#We have 0.5*(pixel_num/2) unused pixels at the bottom, so shift down by (1/2)*0.5*(pixel_num/2)</span>
        <span class="n">canvas_y_coord</span> <span class="o">=</span> <span class="n">canvas_y_coord</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">pixel_num</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        
        
        
        <span class="c">#To convert the triangle x_coord to a canvas coord:</span>
        <span class="c">#Multiply by pixel_num/2 to take up all pixels</span>
        <span class="n">canvas_x_coord</span> <span class="o">=</span> <span class="n">x_coord</span><span class="o">*</span><span class="p">(</span><span class="n">pixel_num</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

        <span class="c">#Shift everything by pixel_num/2 to put x=1 at the right of our canvas (without padding)</span>
        <span class="n">canvas_x_coord</span> <span class="o">=</span> <span class="n">canvas_x_coord</span> <span class="o">+</span> <span class="p">(</span><span class="n">pixel_num</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c">#shift right by half the word padding we alloted</span>
        <span class="n">canvas_x_coord</span> <span class="o">=</span> <span class="n">canvas_x_coord</span> <span class="o">+</span> <span class="n">word_padding</span><span class="o">/</span><span class="mi">2</span>
        
        
        <span class="c">#Assign the color to the coordinate on our canvas</span>
        <span class="n">color_map</span><span class="p">[</span><span class="n">canvas_y_coord</span><span class="p">,</span><span class="n">canvas_x_coord</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="mi">1</span>
     
        
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>/Users/richardknoche/anaconda/lib/python3.5/site-packages/ipykernel/__main__.py:49: DeprecationWarning: using a non-integer number instead of an integer will result in an error in the future
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Display the final canvas</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">color_map</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s">'lower'</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s">'none'</span><span class="p">)</span>

<span class="c">#Label the corners of the triangle</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">pixel_num</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">35</span><span class="p">,</span> <span class="n">pixel_num</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="s">'Valor'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s">'top'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="n">word_padding</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="s">'Instinct'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s">'top'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">pixel_num</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="n">word_padding</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="s">'Mystic'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s">'top'</span><span class="p">)</span>

<span class="c">#Remove axes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>

<span class="c">#Save the image</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'ColorLegend.png'</span><span class="p">)</span>
</code></pre>
</div>

<p>SHOW PLOT LEGEND HERE
<img src="Part%206%20-%20Making%20a%20Choropleth%20Map_files/Part%206%20-%20Making%20a%20Choropleth%20Map_6_0.png" alt="png" /></p>

<h1> Making an Interactive Choropleth Map with Bokeh </h1>

<p>There are a number of Python libraries we could use to produce our Choropleth map.  In this section, we’ll use Python’s <a href="http://bokeh.pydata.org/en/0.11.1/docs/gallery/choropleth.html">Bokeh library</a>.  The Bokeh library provides a variety of tools to produce interactive visualizations of data in an html format.  Compared to other plotting libraries such a <code class="highlighter-rouge">matplotlib</code>, including interactive functionality with Bokeh is a breeze.</p>

<p>First, we need to import a number of tools from the library.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Import Bokeh</span>
<span class="kn">import</span> <span class="nn">bokeh</span>

<span class="c">#Functions for manipulating the plot</span>
<span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">figure</span><span class="p">,</span> <span class="n">output_notebook</span><span class="p">,</span> <span class="n">show</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">ColumnDataSource</span>

<span class="c">#Inline Plotting</span>
<span class="n">output_notebook</span><span class="p">()</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;div class="bk-root"&gt;
    &lt;a href="http://bokeh.pydata.org" target="_blank" class="bk-logo bk-logo-small bk-logo-notebook"&gt;&lt;/a&gt;
    &lt;span id="d86dca9c-4635-4a3f-8e84-bf6784d3855f"&gt;Loading BokehJS ...&lt;/span&gt;
&lt;/div&gt;
</code></pre>
</div>

<p>Convenientally, Bokeh provides <a href="https://github.com/bokeh/bokeh/tree/master/bokeh/sampledata">sample data</a> for a number of topics, one of which is geographic information about the boundaries of US states.  We can access this information from <code class="highlighter-rouge">bokeh.sampledata</code></p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">bokeh.sampledata.us_states</span> <span class="kn">import</span> <span class="n">data</span> <span class="k">as</span> <span class="n">statesData</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">statesData</code> object we just imported is a dictionary.  The keys for the dictionary are the abbreviations for each state, and the values of the dictionary define the boundaries of each state by using lists of lattitude and longitude coordinates.  We’ll want to extract the coordinates of the boundaries.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Remove data on Hawaii and Alaska, since they make our map have to zoom out</span>
<span class="k">del</span> <span class="n">statesData</span><span class="p">[</span><span class="s">"HI"</span><span class="p">]</span>
<span class="k">del</span> <span class="n">statesData</span><span class="p">[</span><span class="s">"AK"</span><span class="p">]</span>

<span class="c">#Extract longitude and lattitude of the state boundaries</span>
<span class="n">state_xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">statesData</span><span class="p">[</span><span class="n">code</span><span class="p">][</span><span class="s">"lons"</span><span class="p">]</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">statesData</span><span class="p">]</span>
<span class="n">state_ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">statesData</span><span class="p">[</span><span class="n">code</span><span class="p">][</span><span class="s">"lats"</span><span class="p">]</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">statesData</span><span class="p">]</span>

</code></pre>
</div>

<p>Next, we need to determine which color to assign to each state on the map.  To do so, we simply use our <code class="highlighter-rouge">RYB_to_RGB</code> function to convert the fraction of tweets about each team to an RGB color.  Bokeh will want the final color denoted in hexadecimal, so we’ll also need to use matplotlib’s <code class="highlighter-rouge">rgb2hex</code> function to convert the RGB color to hex.</p>

<p>Recall that we produced two data frames during our statistical analysis — one in which we removed negative tweets with our sentiment analyzer and one in which we did not.  We did this because our sentiment analyzer only improved our measurement errors if we collected 50 or more tweets about a particular Pokemon Go team in a particular state.  We distinguished states in which our sentiment analyzer improved our measurement error by marking the “Improved” column as <code class="highlighter-rouge">True</code>.  When we determine the color of each state, we’ll want to extract the team dominance information from whichever data frame has smaller measurement errors.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Need matplotlib's function to convert RGB to hex code</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">rgb2hex</span>


<span class="c">#Create an empty list to store the state colors</span>
<span class="n">state_colors</span><span class="o">=</span><span class="p">[]</span>

<span class="c">#Loop over each state</span>
<span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">statesData</span><span class="p">:</span>
    
    <span class="c">#Extract the name of the state</span>
    <span class="n">statename</span> <span class="o">=</span> <span class="n">statesData</span><span class="p">[</span><span class="n">state</span><span class="p">][</span><span class="s">'name'</span><span class="p">]</span>
    
    <span class="c">#Determine which dataframe to use for the state </span>
    <span class="k">if</span> <span class="n">stateInfo</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">statename</span><span class="p">][</span><span class="s">'Improved'</span><span class="p">]:</span>
        <span class="n">dFrame</span> <span class="o">=</span> <span class="n">stateInfo</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dFrame</span> <span class="o">=</span> <span class="n">stateInfo_nosenti</span>
        
    <span class="c">#Determine the RGB color for the state    </span>
    <span class="n">r_level</span> <span class="o">=</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">statename</span><span class="p">][</span><span class="s">'R Frac'</span><span class="p">]</span>
    <span class="n">y_level</span> <span class="o">=</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">statename</span><span class="p">][</span><span class="s">'Y Frac'</span><span class="p">]</span>
    <span class="n">b_level</span> <span class="o">=</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">statename</span><span class="p">][</span><span class="s">'B Frac'</span><span class="p">]</span>                        
    <span class="n">state_colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rgb2hex</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">RYB_to_RGB</span><span class="p">(</span><span class="n">r_level</span><span class="p">,</span><span class="n">y_level</span><span class="p">,</span><span class="n">b_level</span><span class="p">))))</span>
</code></pre>
</div>

<p>A Choropleth map is a nice way to visualize our data, but it can be difficult to interpret the precise meaning of each color on the map.  Therefore, we’ll want to display the exact fraction of tweets referencing each team when a user places their mouse over a state.  To do so, we’ll need to place the team dominance measurements, and errors on those measurements, into separate lists for later use.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Create empty lists for each team dominance measurement</span>
<span class="n">state_names</span><span class="o">=</span><span class="p">[]</span>
<span class="n">state_red_frac</span><span class="o">=</span><span class="p">[]</span>
<span class="n">state_blue_frac</span><span class="o">=</span><span class="p">[]</span>
<span class="n">state_yellow_frac</span><span class="o">=</span><span class="p">[]</span>
<span class="n">state_red_frac_err</span><span class="o">=</span><span class="p">[]</span>
<span class="n">state_blue_frac_err</span><span class="o">=</span><span class="p">[]</span>
<span class="n">state_yellow_frac_err</span><span class="o">=</span><span class="p">[]</span>
<span class="n">state_total_count</span><span class="o">=</span><span class="p">[]</span>

<span class="c">#Loop over each state</span>
<span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">statesData</span><span class="p">:</span>
    
    <span class="c">#Extract the name of the state</span>
    <span class="n">statename</span> <span class="o">=</span> <span class="n">statesData</span><span class="p">[</span><span class="n">state</span><span class="p">][</span><span class="s">'name'</span><span class="p">]</span>
    
    <span class="c">#Determine which dataframe to use for the state </span>
    <span class="k">if</span> <span class="n">stateInfo</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">statename</span><span class="p">][</span><span class="s">'Improved'</span><span class="p">]:</span>
        <span class="n">dFrame</span> <span class="o">=</span> <span class="n">stateInfo</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dFrame</span> <span class="o">=</span> <span class="n">stateInfo_nosenti</span>
        
    <span class="c">#Determine the team dominance metric for the state  </span>
    <span class="n">r_level</span> <span class="o">=</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">statename</span><span class="p">][</span><span class="s">'R Frac'</span><span class="p">]</span>
    <span class="n">y_level</span> <span class="o">=</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">statename</span><span class="p">][</span><span class="s">'Y Frac'</span><span class="p">]</span>
    <span class="n">b_level</span> <span class="o">=</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">statename</span><span class="p">][</span><span class="s">'B Frac'</span><span class="p">]</span>                        
    
    <span class="c">#Append information to the lists</span>
    <span class="n">state_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">statename</span><span class="p">)</span>
    <span class="n">state_red_frac</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_level</span><span class="p">)</span>
    <span class="n">state_blue_frac</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b_level</span><span class="p">)</span>
    <span class="n">state_yellow_frac</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_level</span><span class="p">)</span>
    <span class="n">state_red_frac_err</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">statename</span><span class="p">][</span><span class="s">'R Frac Err'</span><span class="p">])</span>
    <span class="n">state_blue_frac_err</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">statename</span><span class="p">][</span><span class="s">'B Frac Err'</span><span class="p">])</span> 
    <span class="n">state_yellow_frac_err</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">statename</span><span class="p">][</span><span class="s">'Y Frac Err'</span><span class="p">])</span>
    <span class="n">state_total_count</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">statename</span><span class="p">,</span><span class="s">'Num Tweets'</span><span class="p">])</span>
</code></pre>
</div>

<p>Now that we have our data organized and ready to feed into our Choropleth map, we begin to draw the map by creating an empty figure.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Create the plot    </span>
<span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Pokemon Go Team Dominance"</span><span class="p">,</span> <span class="n">toolbar_location</span><span class="o">=</span><span class="s">"left"</span><span class="p">,</span>
           <span class="n">tools</span><span class="o">=</span><span class="s">"pan,wheel_zoom,box_zoom,reset,hover,save"</span><span class="p">,</span>
           <span class="n">x_axis_location</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y_axis_location</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plot_width</span><span class="o">=</span><span class="mi">1100</span><span class="p">,</span> <span class="n">plot_height</span><span class="o">=</span><span class="mi">700</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="bp">None</span>

</code></pre>
</div>

<p>We can import all of the information we collected above into Bokeh by feeding it in a as a dict to Bokeh’s ‘<code class="highlighter-rouge">ColumnDataSource</code> method.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Import the text data to the plot</span>
<span class="n">data_source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">state_xs</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">state_ys</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">state_colors</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="n">state_names</span><span class="p">,</span>
    <span class="n">red_frac</span><span class="o">=</span><span class="n">state_red_frac</span><span class="p">,</span>
    <span class="n">blue_frac</span><span class="o">=</span><span class="n">state_blue_frac</span><span class="p">,</span>
    <span class="n">yellow_frac</span><span class="o">=</span><span class="n">state_yellow_frac</span><span class="p">,</span>
    <span class="n">red_frac_err</span><span class="o">=</span><span class="n">state_red_frac_err</span><span class="p">,</span>
    <span class="n">blue_frac_err</span><span class="o">=</span><span class="n">state_blue_frac_err</span><span class="p">,</span>
    <span class="n">yellow_frac_err</span><span class="o">=</span><span class="n">state_yellow_frac_err</span><span class="p">,</span>
    <span class="n">total_count</span><span class="o">=</span><span class="n">state_total_count</span><span class="p">,</span>
    <span class="p">))</span>
</code></pre>
</div>

<p>Now, we can tell Bokeh to fill in patches of color inbetween the x and y coordinates of each state.  Once we declare our <code class="highlighter-rouge">data_source</code> object as the source of information, Bokeh will be able to extract the x and y coordinates of the state boundaries, as well as the color we assigned to each state, by referencing the <code class="highlighter-rouge">data_source</code> dictionary keys.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Color the states</span>
<span class="n">p</span><span class="o">.</span><span class="n">patches</span><span class="p">(</span><span class="s">'x'</span><span class="p">,</span> <span class="s">'y'</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">data_source</span><span class="p">,</span>
          <span class="n">fill_color</span><span class="o">=</span><span class="s">'color'</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
          <span class="n">line_color</span><span class="o">=</span><span class="s">"white"</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;bokeh.models.renderers.GlyphRenderer at 0x104135e10&gt;
</code></pre>
</div>

<p>We can include the mouse over functionality we previously discussed using Bokeh’s <code class="highlighter-rouge">HoverTool</code> method.  The <code class="highlighter-rouge">tooltips</code> method allows us to specify which information we’d like to display during a mouse over.  In this case, I chose to show the state name and the fraction of tweets which refer to each team (along with the errors).</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">HoverTool</span>

<span class="c">#Include hover over functionality to see text</span>
<span class="c">#{1.111} notation specifies how many decimals to display</span>
<span class="n">hover</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="n">HoverTool</span><span class="p">)</span>
<span class="n">hover</span><span class="o">.</span><span class="n">point_policy</span> <span class="o">=</span> <span class="s">"follow_mouse"</span>
<span class="n">hover</span><span class="o">.</span><span class="n">tooltips</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s">"State"</span><span class="p">,</span> <span class="s">"@name"</span><span class="p">),</span>
    <span class="p">(</span><span class="s">"Red Team Fraction"</span><span class="p">,</span> <span class="s">"@red_frac{1.111} +/- @red_frac_err{1.11}"</span><span class="p">),</span>
    <span class="p">(</span><span class="s">"Yellow Team Fraction"</span><span class="p">,</span> <span class="s">"@yellow_frac{1.111} +/- @yellow_frac_err{1.11}"</span><span class="p">),</span>
    <span class="p">(</span><span class="s">"Blue Team Fraction"</span><span class="p">,</span> <span class="s">"@blue_frac{1.111} +/- @blue_frac_err{1.11}"</span><span class="p">),</span>
    <span class="p">(</span><span class="s">"Total Tweets"</span><span class="p">,</span> <span class="s">"@total_count"</span><span class="p">),</span>
<span class="p">]</span>

</code></pre>
</div>

<p>After constructing the Choropleth map, we simply need to save it as an html file and tell Python to display the result.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Output html file</span>
<span class="n">output_file</span><span class="p">(</span><span class="s">"Pokemon Go Team Dominance.html"</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">"Pokemon Go Team Dominance"</span><span class="p">)</span>

<span class="c">#Show the plot</span>
<span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</code></pre>
</div>

<p>SHOW BOKEH PLOT HERE
SHOW PLOT LEGEND HERE</p>

<h1 id="a-namebasemapa-making-a-basemap-colored-by-prominent-team"><a name="basemap"></a> Making a Basemap Colored by Prominent Team</h1>

<p>Instead of coloring the Choropleth map according to the fraction of tweets which reference each team, we could color the map based on whichever team has the highest fraction of tweets in a particular state.  Such a map would not need mouse over functionality, since the distinct red, blue, and yellow colors would be easy to understand by eye.  We could modify the Bokeh plot code from the previous section to achieve this, but since we don’t need the plot to be interactive this is an opportune time to introduce one of the other libraries which allow us to produce Choropleth maps.</p>

<p>First, we need to determine which team “owns” each state.  We do so by comparing the fraction of tweets which reference each team in a particular state.  If the fraction of tweets referencing a particular team is higher than the fraction of tweets referencing each other team, we record the color of that team in a new “Dominant” column. If there is a tie, we simply mix the colors of each team together.  For instance, if there are an equal number of Team Mystic and Team Valor tweets, and both are larger than the fraction of Team Instinct tweets, we color the state purple.   Note that statistically, we can only say that the fraction of tweets about a particular team is higher than the other teams if it exceeds the fraction of tweets about each other team by more than our measurement error.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Fill in stateInfo dominant column using whichever dataframe is more accruate </span>
<span class="c">#(even if the data comes from stateInfo_nosenti, we only fill in the Dominant column in the stateInfo dataframe)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stateInfo</span><span class="p">)):</span>
    
    <span class="c">#Determine which dataframe to use</span>
    <span class="k">if</span> <span class="n">stateInfo</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="s">'Improved'</span><span class="p">]:</span>
        <span class="n">dFrame</span> <span class="o">=</span> <span class="n">stateInfo</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dFrame</span> <span class="o">=</span> <span class="n">stateInfo_nosenti</span>
        
    <span class="c">#Set up variables to make code easy to read     </span>
    <span class="n">r_frac</span> <span class="o">=</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'R Frac'</span><span class="p">]</span>   
    <span class="n">r_frac_lower_bound</span> <span class="o">=</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'R Frac'</span><span class="p">]</span> <span class="o">-</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'R Frac Err'</span><span class="p">]</span>
    <span class="n">r_frac_upper_bound</span> <span class="o">=</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'R Frac'</span><span class="p">]</span> <span class="o">+</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'R Frac Err'</span><span class="p">]</span>

    <span class="n">b_frac</span> <span class="o">=</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'B Frac'</span><span class="p">]</span>   
    <span class="n">b_frac_lower_bound</span> <span class="o">=</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'B Frac'</span><span class="p">]</span> <span class="o">-</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'B Frac Err'</span><span class="p">]</span>
    <span class="n">b_frac_upper_bound</span> <span class="o">=</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'B Frac'</span><span class="p">]</span> <span class="o">+</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'B Frac Err'</span><span class="p">]</span>

    <span class="n">y_frac</span> <span class="o">=</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'Y Frac'</span><span class="p">]</span>   
    <span class="n">y_frac_lower_bound</span> <span class="o">=</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'Y Frac'</span><span class="p">]</span> <span class="o">-</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'Y Frac Err'</span><span class="p">]</span>
    <span class="n">y_frac_upper_bound</span> <span class="o">=</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'Y Frac'</span><span class="p">]</span> <span class="o">+</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'Y Frac Err'</span><span class="p">]</span>

            
    <span class="c">#Check if the red team dominates by more than measurement error    </span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r_frac</span> <span class="o">&gt;</span> <span class="n">b_frac_upper_bound</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span> <span class="n">r_frac</span> <span class="o">&gt;</span> <span class="n">y_frac_upper_bound</span><span class="p">):</span>
        <span class="n">stateInfo</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'Dominant'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'red'</span>
        
    <span class="c">#Check if the blue team dominates by more than measurement error            </span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">b_frac</span> <span class="o">&gt;</span> <span class="n">r_frac_upper_bound</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span> <span class="n">b_frac</span> <span class="o">&gt;</span> <span class="n">y_frac_upper_bound</span><span class="p">):</span>
        <span class="n">stateInfo</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'Dominant'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'blue'</span>
        
    <span class="c">#Check if the yellow team dominates by more than measurement error        </span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">y_frac</span> <span class="o">&gt;</span> <span class="n">r_frac_upper_bound</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span> <span class="n">y_frac</span> <span class="o">&gt;</span> <span class="n">b_frac_upper_bound</span><span class="p">):</span>        
        <span class="n">stateInfo</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'Dominant'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'yellow'</span>
    
    
    <span class="c">#Check for a tie between red and yellow teams   </span>
    <span class="k">elif</span> <span class="p">(</span> <span class="n">r_frac</span> <span class="o">&gt;</span> <span class="n">b_frac_upper_bound</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">r_frac</span> <span class="o">&gt;=</span> <span class="n">y_frac_lower_bound</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">r_frac</span> <span class="o">&lt;=</span> <span class="n">y_frac_upper_bound</span><span class="p">):</span>        
        <span class="n">stateInfo</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'Dominant'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'orange'</span>    
        
    <span class="c">#Check for a tie between yellow and blue teams  </span>
    <span class="k">elif</span> <span class="p">(</span> <span class="n">b_frac</span> <span class="o">&gt;</span> <span class="n">r_frac_upper_bound</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">b_frac</span> <span class="o">&gt;=</span> <span class="n">y_frac_lower_bound</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">b_frac</span> <span class="o">&lt;=</span> <span class="n">y_frac_upper_bound</span><span class="p">):</span>        
        <span class="n">stateInfo</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'Dominant'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'green'</span>
        
    <span class="c">#Check for a tie between red and blue teams </span>
    <span class="k">elif</span> <span class="p">(</span> <span class="n">r_frac</span> <span class="o">&gt;</span> <span class="n">y_frac_upper_bound</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">r_frac</span> <span class="o">&gt;=</span> <span class="n">b_frac_lower_bound</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">r_frac</span> <span class="o">&lt;=</span> <span class="n">b_frac_upper_bound</span><span class="p">):</span>              
        <span class="n">stateInfo</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'Dominant'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'purple'</span>  
        
    <span class="c">#If none of the above pass, it is a three way tie    </span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stateInfo</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'Dominant'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'white'</span>
</code></pre>
</div>

<p>We’ll use the <a href="https://basemaptutorial.readthedocs.io/en/latest/installation.html">Basemap library</a> to make this simplified, noninteractive map.  First we need to import the library and some of its functions.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">mpl_toolkits.basemap</span> <span class="kn">import</span> <span class="n">Basemap</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Polygon</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>

<span class="c">#Inline plotting</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

</code></pre>
</div>

<p>When we create a Basemap object we need to specify a number of map parameters.  Here’s a list of what each <a href="http://matplotlib.org/basemap/api/basemap_api.html">parameter</a> does:</p>

<ul>
  <li><code class="highlighter-rouge">llcrnrlon</code> sets the longitude of the lower left hand corner of the map domain</li>
  <li><code class="highlighter-rouge">llcrnrlat</code> sets the latitude of the lower left hand corner of the map domain</li>
  <li><code class="highlighter-rouge">urcrnrlon</code> sets the longitude of the upper right hand corner of the map domain</li>
  <li><code class="highlighter-rouge">urcrnrlat</code> sets the latitude of the upper right hand corner of the map domain</li>
  <li><code class="highlighter-rouge">projection</code> set the <a href="http://matplotlib.org/basemap/users/mapsetup.html">method for projecting a curved surface</a> (the earth) onto a 2 dimensional map.</li>
  <li><code class="highlighter-rouge">lat_0</code> and <code class="highlighter-rouge">lon_0</code> set the center of the map domain</li>
  <li><code class="highlighter-rouge">lat_1</code> and <code class="highlighter-rouge">lat_2</code> set the standard parallels for the lambert conformal project that we’re using</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">m</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">llcrnrlon</span><span class="o">=-</span><span class="mi">119</span><span class="p">,</span><span class="n">llcrnrlat</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span><span class="n">urcrnrlon</span><span class="o">=-</span><span class="mi">64</span><span class="p">,</span><span class="n">urcrnrlat</span><span class="o">=</span><span class="mi">49</span><span class="p">,</span>
            <span class="n">projection</span><span class="o">=</span><span class="s">'lcc'</span><span class="p">,</span><span class="n">lat_1</span><span class="o">=</span><span class="mi">33</span><span class="p">,</span><span class="n">lat_2</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span><span class="n">lon_0</span><span class="o">=-</span><span class="mi">95</span><span class="p">)</span>
</code></pre>
</div>

<p>Next, we’ll load a set of <a href="http://basemaptutorial.readthedocs.io/en/latest/shapefile.html">shapefiles</a> that define the boundaries to draw on our map.  We’ll need to find shp, sbf, and shx files that define the boundaries that we want use.  In this case, I used the “st99_d00” shapefiles from <a href="https://github.com/matplotlib/basemap/tree/master/examples">matplotlib’s Github page</a>.  To load the shapefiles, we use the <code class="highlighter-rouge">readshapefile</code> method.  The first argument of this method is the name of our shapefiles (without any extension), the second argument assigns a name to access the shapefile information in our code, and the third argument tells the map that we want to draw solid lines between each of the boundaries.</p>

<p>We can access the information that our shapefiles imported with the <code class="highlighter-rouge">m.states_info</code> class member, where the word states will be whatever the second argument in <code class="highlighter-rouge">readshapefile</code> was set to.  To color in each state in the map we loop through the shapefile information, extracting the state names and creating a dictionary of colors which we wish to associate with those state names. Once we’ve built the dictionary of colors for each state, we use matplotlib’s <code class="highlighter-rouge">poly</code> and <code class="highlighter-rouge">add_patch</code> to color in each of the boundaries defined in by our shapefiles.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">shp_info</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">readshapefile</span><span class="p">(</span><span class="s">'st99_d00'</span><span class="p">,</span><span class="s">'states'</span><span class="p">,</span><span class="n">drawbounds</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c">#Define empty dictionary and list</span>
<span class="n">colors</span><span class="o">=</span><span class="p">{}</span>

<span class="c">#Loop through the shapefile information</span>
<span class="k">for</span> <span class="n">nstate</span><span class="p">,</span> <span class="n">shapedict</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">states_info</span><span class="p">):</span>
    
    <span class="c">#Extract the state name</span>
    <span class="n">statename</span> <span class="o">=</span> <span class="n">shapedict</span><span class="p">[</span><span class="s">'NAME'</span><span class="p">]</span>
    
    <span class="c">#Extract the color we assigned to that state</span>
    <span class="n">colors</span><span class="p">[</span><span class="n">nstate</span><span class="p">]</span> <span class="o">=</span> <span class="n">stateInfo</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">statename</span><span class="p">][</span><span class="s">'Dominant'</span><span class="p">]</span>
    

<span class="c">#get current axes instance</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span> 

<span class="c">#loop through the boundaries defined by our shape map</span>
<span class="k">for</span> <span class="n">nshape</span><span class="p">,</span><span class="n">seg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">states</span><span class="p">):</span>
    
    <span class="c">#Get the color of the state from our dictionary</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">nshape</span><span class="p">]</span>
    
    <span class="c">#Use poly to color in the boundary</span>
    <span class="n">poly</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">seg</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span> 
    

<span class="c">#Show the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Pokemon Go Team Dominance'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'PoGo_DominantTeam'</span><span class="p">)</span>        
</code></pre>
</div>

<p>SHOW BASEMAP PLOT HERE
<img src="Part%206%20-%20Making%20a%20Choropleth%20Map_files/Part%206%20-%20Making%20a%20Choropleth%20Map_34_0.png" alt="png" /></p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;matplotlib.figure.Figure at 0x1228d4f60&gt;
</code></pre>
</div>

<h1 id="discussing-the-analysis-results">Discussing the analysis results</h1>

<p>If we only look at the basemap result, we see that Team Valor is the most dominant team in 23 states.  Team Mystic claims eight states, and ties for ownership with Team Valor in 18 states (including Peurto Rico and DC).  Team Instinct seems less popular, only having shared ownership of three states.  In two of the states, we could not say that any particular team owned the state with statistical signifance.</p>

<p>The popularity of the Pokemon Go teams are not as one sided as the Basemap would lead you to believe.  Our interactive Bokeh plot shows that the majority of states are tinted purple when you account for the fraction of tweets from every team in the state.  This indicates that even though Team Valor is the most dominant team in many states, Team Mystic is a close second in popularity.  In fact, if we look at the total number of tweets about each team, regardless of the location of those tweets, we see that Team Valor represents 40 $\pm$ 1% of our tweets, Team Mystic represents 37 $\pm$ 1% of our tweets, and Team Instinct represents 23 $\pm$ 0.5% of our tweets.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Counting tweets regardless of origin</span>
<span class="n">red_tweets</span><span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">stateInfo</span><span class="p">[</span><span class="s">'Num Red'</span><span class="p">])</span>
<span class="n">blue_tweets</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">stateInfo</span><span class="p">[</span><span class="s">'Num Blue'</span><span class="p">])</span>
<span class="n">yellow_tweets</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">stateInfo</span><span class="p">[</span><span class="s">'Num Yellow'</span><span class="p">])</span>

<span class="c">#Statistical analysis -- same strategy as in the previous blog post</span>
<span class="n">sys_err</span> <span class="o">=</span> <span class="mf">0.024</span>
<span class="n">red_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">red_tweets</span> <span class="o">+</span> <span class="p">(</span><span class="n">red_tweets</span><span class="o">*</span><span class="n">sys_err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
<span class="n">blue_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">blue_tweets</span> <span class="o">+</span> <span class="p">(</span><span class="n">blue_tweets</span><span class="o">*</span><span class="n">sys_err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
<span class="n">yellow_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">yellow_tweets</span> <span class="o">+</span> <span class="p">(</span><span class="n">yellow_tweets</span><span class="o">*</span><span class="n">sys_err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>

<span class="n">r_frac</span> <span class="o">=</span> <span class="n">red_tweets</span><span class="o">/</span><span class="p">(</span><span class="n">red_tweets</span> <span class="o">+</span> <span class="n">blue_tweets</span> <span class="o">+</span> <span class="n">yellow_tweets</span><span class="p">)</span>
<span class="n">b_frac</span> <span class="o">=</span> <span class="n">blue_tweets</span><span class="o">/</span><span class="p">(</span><span class="n">red_tweets</span> <span class="o">+</span> <span class="n">blue_tweets</span> <span class="o">+</span> <span class="n">yellow_tweets</span><span class="p">)</span>
<span class="n">y_frac</span> <span class="o">=</span> <span class="n">yellow_tweets</span><span class="o">/</span><span class="p">(</span><span class="n">red_tweets</span> <span class="o">+</span> <span class="n">blue_tweets</span> <span class="o">+</span> <span class="n">yellow_tweets</span><span class="p">)</span>

<span class="n">r_frac_err</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="n">red_err</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">blue_tweets</span> <span class="o">+</span> <span class="n">yellow_tweets</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> \
              <span class="n">red_tweets</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">blue_err</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yellow_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> \
             <span class="p">(</span><span class="n">yellow_tweets</span> <span class="o">+</span> <span class="n">blue_tweets</span> <span class="o">+</span> <span class="n">red_tweets</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

<span class="n">y_frac_err</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="n">yellow_err</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">red_tweets</span> <span class="o">+</span> <span class="n">blue_tweets</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> \
              <span class="n">yellow_tweets</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">blue_err</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">red_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> \
             <span class="p">(</span><span class="n">yellow_tweets</span> <span class="o">+</span> <span class="n">blue_tweets</span> <span class="o">+</span> <span class="n">red_tweets</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>


<span class="n">b_frac_err</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="n">blue_err</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">yellow_tweets</span> <span class="o">+</span> <span class="n">red_tweets</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> \
               <span class="n">blue_tweets</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">yellow_err</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">red_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> \
             <span class="p">(</span><span class="n">yellow_tweets</span> <span class="o">+</span> <span class="n">red_tweets</span> <span class="o">+</span> <span class="n">blue_tweets</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>    
      
<span class="c">#Make bar graph</span>
<span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c">#Bars</span>
<span class="n">rects1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">r_frac</span><span class="p">,</span> <span class="n">bar_width</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.6</span><span class="p">])</span>
<span class="n">rects2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">b_frac</span><span class="p">,</span> <span class="n">bar_width</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.6</span><span class="p">])</span>
<span class="n">rects3</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">y_frac</span><span class="p">,</span> <span class="n">bar_width</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.6</span><span class="p">])</span>

<span class="c">#Errors on the bars</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="mi">0</span><span class="o">+</span><span class="n">bar_width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">r_frac</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">r_frac_err</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">'.'</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="s">'1'</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> <span class="n">elinewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="mf">0.4</span><span class="o">+</span><span class="n">bar_width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">b_frac</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">b_frac_err</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">'.'</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="s">'1'</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> <span class="n">elinewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="mf">0.8</span><span class="o">+</span><span class="n">bar_width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">y_frac</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">y_frac_err</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">'.'</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="s">'1'</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> <span class="n">elinewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c">#Plot labeling</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'Fraction of Tweets'</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.8</span><span class="p">])</span> <span class="o">+</span> <span class="n">bar_width</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">((</span><span class="s">'Valor'</span><span class="p">,</span> <span class="s">'Mystic'</span><span class="p">,</span> <span class="s">'Instinct'</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">'both'</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s">'major'</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre>
</div>

<p>SHOW POGO BARMAP PLOT HERE
<img src="https://raw.githubusercontent.com/Raknoche/Raknoche.github.io/master/_posts/Images/Multithreaded-hours-timeline.png" alt="png" /></p>

<h1 id="closing-remarks">Closing remarks</h1>

<p>It too a lot of work, but we succesfully used Twitter to quantify the dominance of the Pokemon Go teams in each state.  Along the way we learned details of the Twitter API, and how to use Python’s Tweepy library to interface with the API and collect tweets. We built an understanding of Naive Bayes Classifiers, and trained one to classify the sentiment of each tweet that we collected.  We used the sentiment analyzer to remove negative tweets from our collection, along with the multi-team tweets, and repeated-user tweets that we removed with Pandas.  With the cleaned data, we performed a statistical analysis to determine the dominance of each Pokemon Go team in every state while properly accounting for errors on our measurement.  Finally, we visualized discussed our results in this final post.  Congratulations on making it through the six-post series.  If you learned anything useful along the way, or have any questions about the topics we covered, feel free to leave a comment below.</p>

  
</div>


<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<div class="social-media">
    Share this: 
    <a class="social-media-box" href="https://twitter.com/intent/tweet?text=PoGo Series&#58; Making a Choropleth Map&url=http://www.dealingdata.net/2016/08/03/PoGo-Series-Making-a-Choropleth-Map/&via=&related=" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fa fa-twitter fa-sm-90"></i>Twitter</a>
    <a class="social-media-box" href="https://facebook.com/sharer.php?u=http://www.dealingdata.net/2016/08/03/PoGo-Series-Making-a-Choropleth-Map/" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fa fa-facebook-f fa-sm-90"></i>Facebook</a>
    <a class="social-media-box" href="https://plus.google.com/share?url=http://www.dealingdata.net/2016/08/03/PoGo-Series-Making-a-Choropleth-Map/" rel="nofollow" target="_blank" title="Share on Google+"><i class="fa fa-google-plus fa-sm-90"></i>Google+</a>
</div>


<div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    
    
    var disqus_config = function () {
        this.page.url = "http://dealingdata.net/2016/08/03/PoGo-Series-Making-a-Choropleth-Map/";  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = "dealingdata.net/2016/08/03/PoGo-Series-Making-a-Choropleth-Map/"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        
        s.src = '//dealingdata.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


                                  

      </div>
    </div>



  </body>
</html>
