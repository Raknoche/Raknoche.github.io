<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      PoGo Series&#58; Statistical Analysis of Data &middot; Dealing Data
    
  </title>

  <!-- Sidebar Icon Links-->
  <link rel="stylesheet" href="/fonts/font-awesome/css/font-awesome.min.css"> 
  <link rel="stylesheet" href="/fonts/cvFonts/styles.css"> 
  

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-81371278-1', 'auto');
  ga('send', 'pageview');

</script>

  <body>

    <div class="sidebar">
    <div class="sidebar-about">
      <h1>
          Dealing Data
      </h1>
    </div>

    <div class="sidebar-item">
      <p>A blog dedicated to learning data science techniques by applying them to real world data.</p>
    </div>


    <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/archive/">Archive</a>
          
        
      
        
      
        
          
        
      
        
          
        
      

      <!-- <a class="sidebar-nav-item" href=" http://www.github.com/raknoche ">GitHub Repo</a> -->
      <!-- <span class="sidebar-nav-item">Currently v1.0.0</span> -->

    <link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
  #mc_embed_signup{background:#202020; clear:left; font:14px Helvetica,Arial,sans-serif; }
  /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
     We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="//dealingdata.us13.list-manage.com/subscribe/post?u=194dacfdd7036fb11766517ff&amp;id=c0d39c54f6" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
  <h2 class="subscribe">Subscribe to our mailing list</h2>
<div class="mc-field-group">
  <label for="mce-EMAIL">Email Address </label>
  <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
</div>
  <div id="mce-responses" class="clear">
    <div class="response" id="mce-error-response" style="display:none"></div>
    <div class="response" id="mce-success-response" style="display:none"></div>
  </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_194dacfdd7036fb11766517ff_c0d39c54f6" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button" style="color: #202020"></div>
  </div>
</form>
</div>

    </nav>

    <!-- <p>&copy; 2016. All rights reserved.</p> -->
    <div class="sidebar-item">
     <p class="social-icons">
       <a href="https://github.com/raknoche"><i class="fa fa-github fa-2x"></i></a>
       <a href="https://www.linkedin.com/in/richard-knoche-ba8bb1122"><i class="fa fa-linkedin fa-2x"></i></a>
       <a href="mailto:raknoche@dealingdata.net"><i class="fa fa-envelope fa-2x"></i></a>
       <a href="https://github.com/Raknoche/CV_and_Resume/blob/master/CV/RichardKnoche_CV.pdf"><i class="icon-roundcv fa-2x"></i></a>
      
     </p>
     <p>
       &copy; 2016. All rights reserved.
     </p>
   </div>
</div>



    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div>
      <div class="masthead">
        <div class="container-mast">
          <h3 class="masthead-title">
            <a href="/" title="Home">Dealing Data</a>
            <small>Learning data science through example</small>
          </h3>
        </div>
      </div>
      
      <div class="container content">
        <div class="post">
  <h1 class="post-title">PoGo Series&#58; Statistical Analysis of Data</h1>
  <span class="post-date">31 Jul 2016</span>
  <div class="post-content">
  
    

<p>Table of Contents:</p>

<ol>
  <li><a href="http://raknoche.github.io/2016/07/20/PoGo-Series-Intro/">Introduction to the Series</a></li>
  <li><a href="http://raknoche.github.io/2016/07/21/PoGo-Series-TwitterAPI/">The Twitter API</a></li>
  <li><a href="http://raknoche.github.io/2016/07/23/PoGo-Series-Tweepy/">The Tweepy Library</a></li>
  <li><a href="http://raknoche.github.io/2016/07/24/PoGo-Series-NaiveBayesClassifier/">Naive Bayes Classifiers</a></li>
  <li><a href="http://raknoche.github.io/2016/07/28/PoGo-Series-Sentiment-Analyzer/">Training a Sentiment Analyzer</a></li>
  <li><a href="http://raknoche.github.io/2016/07/31/PoGo-Series-Statistical-Analysis-of-the-Data/">Statistical Analysis of the Data</a></li>
  <li><a href="http://raknoche.github.io/2016/08/03/PoGo-Series-Making-a-Choropleth-Map/">Visualizing the Data with Choropleth Maps</a></li>
</ol>

<hr />

<p>Welcome to the second-to-last post in our Pokemon Go analysis series.  <a href="http://raknoche.github.io/2016/07/28/PoGo-Series-Sentiment-Analyzer/">Last time</a>, we trained a sentiment analyzer that will allow us to remove negative tweets from our collection.  In this post, we’ll use this analyzer to clean up our data and determine the dominance of each Pokemon Go team in each state.  Once we’ve cleaned the data, we’ll count the number of tweets referencing each Pokemon Go team in every state.  In the end, we’ll use the fraction of tweets referencing each team as a measure of the dominance of the teams in each state.  Along the way, we’ll discuss how to properly account for statistical and systematic errors in our measurement.</p>

<p>We’ll cover the following topics:</p>

<ol>
  <li><a href="#cleaning">Cleaning the data</a></li>
  <li><a href="#location">Finding the location of each tweet</a></li>
  <li><a href="#dominance">Measuring team dominance in each state</a></li>
  <li><a href="#stats">Statistical analysis of the data</a></li>
</ol>

<h1 id="a-namecleaninga-cleaning-the-data"><a name="cleaning"></a> Cleaning the Data</h1>

<p>Before we begin, we’ll need to load the our collection of tweets into Pandas.  We already did this in our <a href="http://raknoche.github.io/2016/07/28/PoGo-Series-Sentiment-Analyzer/">last post</a>, and saved to the result to a csv file. We can load that csv file with the following code:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#This is needed to load our csv</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="c">#We'll also use numpy to do some math later</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Load the full collection of PoGo tweets</span>
<span class="n">PoGo_tweets</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'PoGo_Sentiment_AllTweets.csv'</span><span class="p">)</span>
<span class="n">PoGo_tweets</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s">'Unnamed: 0'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">PoGo_tweets</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre>
</div>

<div id="table-scroll">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>screenName</th>
      <th>userId</th>
      <th>text</th>
      <th>location</th>
      <th>multi-team</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>desmond_ayala</td>
      <td>2.953472e+09</td>
      <td>Which pokemon go team did y'all chose? #valor</td>
      <td>Caldwell, ID</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>aphrospice</td>
      <td>1.629086e+07</td>
      <td>#Magikarp practicing his struggle skills in th...</td>
      <td>Brooklyn, NY</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ABellgowan</td>
      <td>1.681036e+09</td>
      <td>Pokemon Go is taking over my life #TeamInstinct</td>
      <td>Bixby, OK</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>JangoSnow</td>
      <td>1.057434e+07</td>
      <td>Go Team Instinct! I like underdogs. :)  https:...</td>
      <td>Los Angeles, CA</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>EmberLighta2</td>
      <td>7.513920e+17</td>
      <td>#TeamMystic has total control of Niagara Falls!!</td>
      <td>Niagara Falls, NY</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>

<p>Recall that the csv file has already had all tweets that reference multiple teams removed, since we decided it would be too hard to identify which team the Twitter user was on from such tweets.</p>

<p>We’d like to remove any negatively-toned tweets from our collection so that we can assume any remaining tweets about the team indicates that the Twitter user is a member of that team.  We can do so by applying the sentiment analyzer that we developed in our <a href="http://raknoche.github.io/2016/07/28/PoGo-Series-Sentiment-Analyzer/">last post</a>.  First, we use <code class="highlighter-rouge">pickle</code> to load the sentiment analyzer and feature list that we created.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#load the classifier</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'PoGo_tweet_classifier.pickle'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span>
<span class="n">classifier</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c">#load the list of features used in the classifier</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'PoGo_classifier_feats.pickle'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">word_features</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre>
</div>

<p>We’ll also need to use the <code class="highlighter-rouge">filter_tweets</code> and <code class="highlighter-rouge">extract_features</code> functions that we wrote for our sentiment analyzer.  In this case, I’ve slightly modified the <code class="highlighter-rouge">filter_tweets</code> function — it now produces a list of filtered unigrams and bigrams for each tweet instead of a tuple, since we have no manually labeled sentiment to pair with such a list.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Load the required modules</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">from</span> <span class="nn">nltk.metrics</span> <span class="kn">import</span> <span class="n">BigramAssocMeasures</span>
<span class="kn">from</span> <span class="nn">nltk.collocations</span> <span class="kn">import</span> <span class="n">BigramCollocationFinder</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">string</span>


<span class="c">#Set of punctuation to exclude from unigrams and bigrams</span>
<span class="n">exclude</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">)</span>

<span class="c">#List of team-identifying words to exclude from unigrams and bigrams</span>
<span class="n">excluded_words</span> <span class="o">=</span> <span class="p">[</span><span class="s">'teammystic'</span><span class="p">,</span><span class="s">'mystic'</span><span class="p">,</span><span class="s">'teamblue'</span><span class="p">,</span><span class="s">'blue'</span><span class="p">,</span>\
                  <span class="s">'teaminstinct'</span><span class="p">,</span><span class="s">'instinct'</span><span class="p">,</span><span class="s">'teamyellow'</span><span class="p">,</span><span class="s">'yellow'</span><span class="p">,</span>\
                  <span class="s">'teamvalor'</span><span class="p">,</span><span class="s">'valor'</span><span class="p">,</span><span class="s">'teamred'</span><span class="p">,</span><span class="s">'red'</span><span class="p">]</span>


<span class="c">#Function that provides a list of filtered unigrams and bigrams from each tweet</span>
<span class="k">def</span> <span class="nf">filter_tweets</span><span class="p">(</span><span class="n">tweet_text</span><span class="p">):</span>
    <span class="n">words_filtered</span><span class="o">=</span><span class="p">[]</span>

    <span class="c">#For each word in the tweet, filter on our feature requirements.</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">tweet_text</span><span class="o">.</span><span class="n">split</span><span class="p">():</span> 

        <span class="c">#Remove punctuation</span>
        <span class="n">word</span> <span class="o">=</span> <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ch</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">word</span> <span class="k">if</span> <span class="n">ch</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">)</span>

        <span class="c">#Remove one letter words</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span> 

                <span class="c">#treat URLs the same</span>
                <span class="k">if</span> <span class="n">word</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">'http'</span><span class="p">:</span>
                    <span class="n">word</span><span class="o">=</span><span class="s">'http'</span>

                <span class="c">#remove hashtags</span>
                <span class="k">if</span> <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">'#'</span><span class="p">:</span> 
                    <span class="n">word</span><span class="o">=</span><span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

                <span class="c">#remove team identifiers</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excluded_words</span><span class="p">):</span>

                    <span class="c">#require lower case</span>
                    <span class="n">words_filtered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> 
    
    <span class="c">#If the word list contains only duplicates of one word, it causes problems for bigram finder</span>
    <span class="c">#In this case, don't bother trying to find bigrams, just find the unigram since there are no bigrams anyway</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">words_filtered</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">tweet_feats</span> <span class="o">=</span> <span class="n">words_filtered</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>  
        <span class="c">#Identify top 200 bigams in the filtered word list using chi_sq measure of importance</span>
        <span class="n">bigram_finder</span> <span class="o">=</span> <span class="n">BigramCollocationFinder</span><span class="o">.</span><span class="n">from_words</span><span class="p">(</span><span class="n">words_filtered</span><span class="p">)</span>
        <span class="n">bigrams</span> <span class="o">=</span> <span class="n">bigram_finder</span><span class="o">.</span><span class="n">nbest</span><span class="p">(</span><span class="n">BigramAssocMeasures</span><span class="o">.</span><span class="n">chi_sq</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>  

        <span class="n">tweet_feats</span> <span class="o">=</span> <span class="p">[</span><span class="n">ngram</span> <span class="k">for</span> <span class="n">ngram</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">words_filtered</span><span class="p">,</span> <span class="n">bigrams</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">tweet_feats</span>


<span class="c">#Feature extractor - determines which word features are in each tweet</span>
<span class="k">def</span> <span class="nf">extract_features</span><span class="p">(</span><span class="n">filtered_tweet</span><span class="p">):</span>

    <span class="c">#list of unigrams and bigrams in the tweet</span>
    <span class="n">filtered_tweet_words</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">filtered_tweet</span><span class="p">)</span>
    
    <span class="c">#Define a features dictionary</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c">#Loop of all word features</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">word_features</span><span class="p">:</span>
        
        <span class="c">#Set 'contains(word_feature)' as a key in the dictionary</span>
        <span class="c">#Set the value for that key to True or False</span>
        <span class="n">features</span><span class="p">[</span><span class="s">'contains(</span><span class="si">%</span><span class="s">s)'</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">word</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">filtered_tweet_words</span><span class="p">)</span>

    <span class="c">#Return the final features dictionary for that tweet</span>
    <span class="k">return</span> <span class="n">features</span>
</code></pre>
</div>

<p>To classify the sentiment of each tweets in our collection, we first apply the <code class="highlighter-rouge">filter_tweets</code> function to extract the filtered unigrams and bigrams from the tweet.  We use that list of unigrams and bigrams to evaluate the <code class="highlighter-rouge">contains(word_feature)</code> statements which we used as features for our sentiment analyzer.  Finally, we pass the feature values to our sentiment analyzer and place the result in a new “sentiment” column in our data frame.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Classifying tweets</span>
<span class="k">def</span> <span class="nf">ClassifyTweets</span><span class="p">(</span><span class="n">dFrame</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dFrame</span><span class="p">)):</span>
        
        <span class="c">#Get filtered unigrams and bigrams</span>
        <span class="n">filtered_text</span> <span class="o">=</span> <span class="n">filter_tweets</span><span class="p">(</span><span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'text'</span><span class="p">])</span>
        
        <span class="c">#Evaluate the contains(word) statements</span>
        <span class="n">tweet_feats</span> <span class="o">=</span> <span class="n">extract_features</span><span class="p">(</span><span class="n">filtered_text</span><span class="p">)</span>
        
        <span class="c">#Add result to new sentimenet column in the dataframe</span>
        <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'sentiment'</span><span class="p">]</span><span class="o">=</span><span class="n">classifier</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">tweet_feats</span><span class="p">)</span>   
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">ClassifyTweets</span><span class="p">(</span><span class="n">PoGo_tweets</span><span class="p">)</span>
<span class="n">PoGo_tweets</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre>
</div>

<div id="table-scroll">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>screenName</th>
      <th>userId</th>
      <th>text</th>
      <th>location</th>
      <th>multi-team</th>
      <th>sentiment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>desmond_ayala</td>
      <td>2.953472e+09</td>
      <td>Which pokemon go team did y'all chose? #valor</td>
      <td>Caldwell, ID</td>
      <td>False</td>
      <td>positive</td>
    </tr>
    <tr>
      <th>1</th>
      <td>aphrospice</td>
      <td>1.629086e+07</td>
      <td>#Magikarp practicing his struggle skills in th...</td>
      <td>Brooklyn, NY</td>
      <td>False</td>
      <td>positive</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ABellgowan</td>
      <td>1.681036e+09</td>
      <td>Pokemon Go is taking over my life #TeamInstinct</td>
      <td>Bixby, OK</td>
      <td>False</td>
      <td>positive</td>
    </tr>
    <tr>
      <th>3</th>
      <td>JangoSnow</td>
      <td>1.057434e+07</td>
      <td>Go Team Instinct! I like underdogs. :)  https:...</td>
      <td>Los Angeles, CA</td>
      <td>False</td>
      <td>positive</td>
    </tr>
    <tr>
      <th>4</th>
      <td>EmberLighta2</td>
      <td>7.513920e+17</td>
      <td>#TeamMystic has total control of Niagara Falls!!</td>
      <td>Niagara Falls, NY</td>
      <td>False</td>
      <td>positive</td>
    </tr>
  </tbody>
</table>
</div>

<p>If a state in the US has a lot of Twitter users we’ll have plenty of tweets for our team dominance measurement.  In this case, removing tweets that our sentiment analyzer has identified as negative will reduce the total error on our measurement.  However, if a particular state has very few tweets about each Pokemon Go team, our sentiment analyzer will reduce our already small sample size.  In turn, this will increase the total error on our team dominance measurement.  I’ll explain why this is the case in the upcoming <a href="#stats">statistical analysis</a> sections, but for now it is sufficient to know that we will not always want to remove the negative tweets from our data set.  Therefore, we must create two branches of our data frame — one in which we do remove negative tweets, and one in which we do not.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Creating a new data frame where we do not apply sentiment analysis</span>
<span class="n">PoGo_tweets_nosenti</span> <span class="o">=</span> <span class="n">PoGo_tweets</span>

<span class="c">#Applying the positive sentiment restriction on the original dataframe</span>
<span class="n">PoGo_tweets</span> <span class="o">=</span> <span class="n">PoGo_tweets</span><span class="p">[</span><span class="n">PoGo_tweets</span><span class="p">[</span><span class="s">'sentiment'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'positive'</span><span class="p">]</span>
<span class="n">PoGo_tweets</span> <span class="o">=</span> <span class="n">PoGo_tweets</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre>
</div>

<p>Next, we’ll want to require that each tweet is coming from a unique user.  If there happens to be a Twitter addict who Tweets about their Pokemon Go team every hour, we don’t want to count them as a member of that team multiple times.  We can ensure this doesn’t happen by indicating the first tweet from each user in a new column of our data set.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">FindUniqueUsers</span><span class="p">(</span><span class="n">dFrame</span><span class="p">):</span>
    <span class="n">unique_users</span><span class="o">=</span><span class="p">[]</span>
    
    <span class="c">#Loop through the tweets in our dataframe</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dFrame</span><span class="p">)):</span>
        
        <span class="c">#If we have already seen this Twitter user, flag the tweet as a repeat</span>
        <span class="k">if</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'screenName'</span><span class="p">]</span> <span class="ow">in</span> <span class="n">unique_users</span><span class="p">:</span>
            <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'repeatUser'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
            
        <span class="c">#Otherwise, add the user to a list so we can identify if they tweet again </span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'repeatUser'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">unique_users</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'screenName'</span><span class="p">])</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Apply the unique user function to both of our data frames</span>
<span class="n">FindUniqueUsers</span><span class="p">(</span><span class="n">PoGo_tweets_nosenti</span><span class="p">)</span>
<span class="n">FindUniqueUsers</span><span class="p">(</span><span class="n">PoGo_tweets</span><span class="p">)</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Remove all but the first tweet from each user in our data frames</span>
<span class="n">PoGo_tweets</span> <span class="o">=</span> <span class="n">PoGo_tweets</span><span class="p">[</span><span class="n">PoGo_tweets</span><span class="p">[</span><span class="s">'repeatUser'</span><span class="p">]</span> <span class="o">==</span> <span class="bp">False</span><span class="p">]</span>
<span class="n">PoGo_tweets_nosenti</span> <span class="o">=</span> <span class="n">PoGo_tweets_nosenti</span><span class="p">[</span><span class="n">PoGo_tweets_nosenti</span><span class="p">[</span><span class="s">'repeatUser'</span><span class="p">]</span> <span class="o">==</span> <span class="bp">False</span><span class="p">]</span>

<span class="c">#Reindex the data frames</span>
<span class="n">PoGo_tweets</span> <span class="o">=</span> <span class="n">PoGo_tweets</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">PoGo_tweets_nosenti</span> <span class="o">=</span> <span class="n">PoGo_tweets_nosenti</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre>
</div>

<h1> <a name="location"></a> Finding the location of each tweet </h1>

<p>Now that we have removed multi-team tweets, negatively-toned tweets, and repeated tweets from the same user from our collection, we are ready to count the number of tweets about each Pokemon Go team in each state.  First, we need to determine which state each tweet came from.  The location column of our data frame almost does this for us, but as you can see below, some tweets have location information in the format <code class="highlighter-rouge">State, Country</code>, while others have location information in the format <code class="highlighter-rouge">City, State Abbreviation</code>.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">PoGo_tweets</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</code></pre>
</div>

<div id="table-scroll">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>screenName</th>
      <th>userId</th>
      <th>text</th>
      <th>location</th>
      <th>multi-team</th>
      <th>sentiment</th>
      <th>repeatUser</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>9434</th>
      <td>TheJakeTyler</td>
      <td>42497434.0</td>
      <td>#TeamMystic let's get it!!!!</td>
      <td>Virginia, USA</td>
      <td>False</td>
      <td>positive</td>
      <td>False</td>
    </tr>
    <tr>
      <th>9435</th>
      <td>LivAboveAverage</td>
      <td>333182239.0</td>
      <td>@AnthonyChott GO TEAM MYSTIC!!! #TeamMystic</td>
      <td>Chesterfield, MO</td>
      <td>False</td>
      <td>positive</td>
      <td>False</td>
    </tr>
    <tr>
      <th>9436</th>
      <td>TylerDurden919</td>
      <td>334394891.0</td>
      <td>10:45 Saturday morning, everyone's at @Bojangl...</td>
      <td>Durham, NC</td>
      <td>False</td>
      <td>positive</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>

<p>We’d like to extract the state information, regardless of which location format is being used.  To do so, we first define a dictionary of state abbreviations and the corresponding state name.  We also will want to create stand-alone lists of state abbreviations and state names from this dictionary.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Dictionary of state abbreviations and names</span>
<span class="n">states</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'AK'</span><span class="p">:</span> <span class="s">'Alaska'</span><span class="p">,</span>
        <span class="s">'AL'</span><span class="p">:</span> <span class="s">'Alabama'</span><span class="p">,</span>
        <span class="s">'AR'</span><span class="p">:</span> <span class="s">'Arkansas'</span><span class="p">,</span>
        <span class="s">'AZ'</span><span class="p">:</span> <span class="s">'Arizona'</span><span class="p">,</span>
        <span class="s">'CA'</span><span class="p">:</span> <span class="s">'California'</span><span class="p">,</span>
        <span class="s">'CO'</span><span class="p">:</span> <span class="s">'Colorado'</span><span class="p">,</span>
        <span class="s">'CT'</span><span class="p">:</span> <span class="s">'Connecticut'</span><span class="p">,</span>
        <span class="s">'DC'</span><span class="p">:</span> <span class="s">'District of Columbia'</span><span class="p">,</span>
        <span class="s">'DE'</span><span class="p">:</span> <span class="s">'Delaware'</span><span class="p">,</span>
        <span class="s">'FL'</span><span class="p">:</span> <span class="s">'Florida'</span><span class="p">,</span>
        <span class="s">'GA'</span><span class="p">:</span> <span class="s">'Georgia'</span><span class="p">,</span>
        <span class="s">'HI'</span><span class="p">:</span> <span class="s">'Hawaii'</span><span class="p">,</span>
        <span class="s">'IA'</span><span class="p">:</span> <span class="s">'Iowa'</span><span class="p">,</span>
        <span class="s">'ID'</span><span class="p">:</span> <span class="s">'Idaho'</span><span class="p">,</span>
        <span class="s">'IL'</span><span class="p">:</span> <span class="s">'Illinois'</span><span class="p">,</span>
        <span class="s">'IN'</span><span class="p">:</span> <span class="s">'Indiana'</span><span class="p">,</span>
        <span class="s">'KS'</span><span class="p">:</span> <span class="s">'Kansas'</span><span class="p">,</span>
        <span class="s">'KY'</span><span class="p">:</span> <span class="s">'Kentucky'</span><span class="p">,</span>
        <span class="s">'LA'</span><span class="p">:</span> <span class="s">'Louisiana'</span><span class="p">,</span>
        <span class="s">'MA'</span><span class="p">:</span> <span class="s">'Massachusetts'</span><span class="p">,</span>
        <span class="s">'MD'</span><span class="p">:</span> <span class="s">'Maryland'</span><span class="p">,</span>
        <span class="s">'ME'</span><span class="p">:</span> <span class="s">'Maine'</span><span class="p">,</span>
        <span class="s">'MI'</span><span class="p">:</span> <span class="s">'Michigan'</span><span class="p">,</span>
        <span class="s">'MN'</span><span class="p">:</span> <span class="s">'Minnesota'</span><span class="p">,</span>
        <span class="s">'MO'</span><span class="p">:</span> <span class="s">'Missouri'</span><span class="p">,</span>
        <span class="s">'MS'</span><span class="p">:</span> <span class="s">'Mississippi'</span><span class="p">,</span>
        <span class="s">'MT'</span><span class="p">:</span> <span class="s">'Montana'</span><span class="p">,</span>
        <span class="s">'NC'</span><span class="p">:</span> <span class="s">'North Carolina'</span><span class="p">,</span>
        <span class="s">'ND'</span><span class="p">:</span> <span class="s">'North Dakota'</span><span class="p">,</span>
        <span class="s">'NE'</span><span class="p">:</span> <span class="s">'Nebraska'</span><span class="p">,</span>
        <span class="s">'NH'</span><span class="p">:</span> <span class="s">'New Hampshire'</span><span class="p">,</span>
        <span class="s">'NJ'</span><span class="p">:</span> <span class="s">'New Jersey'</span><span class="p">,</span>
        <span class="s">'NM'</span><span class="p">:</span> <span class="s">'New Mexico'</span><span class="p">,</span>
        <span class="s">'NV'</span><span class="p">:</span> <span class="s">'Nevada'</span><span class="p">,</span>
        <span class="s">'NY'</span><span class="p">:</span> <span class="s">'New York'</span><span class="p">,</span>
        <span class="s">'OH'</span><span class="p">:</span> <span class="s">'Ohio'</span><span class="p">,</span>
        <span class="s">'OK'</span><span class="p">:</span> <span class="s">'Oklahoma'</span><span class="p">,</span>
        <span class="s">'OR'</span><span class="p">:</span> <span class="s">'Oregon'</span><span class="p">,</span>
        <span class="s">'PA'</span><span class="p">:</span> <span class="s">'Pennsylvania'</span><span class="p">,</span>
        <span class="s">'PR'</span><span class="p">:</span> <span class="s">'Puerto Rico'</span><span class="p">,</span>
        <span class="s">'RI'</span><span class="p">:</span> <span class="s">'Rhode Island'</span><span class="p">,</span>
        <span class="s">'SC'</span><span class="p">:</span> <span class="s">'South Carolina'</span><span class="p">,</span>
        <span class="s">'SD'</span><span class="p">:</span> <span class="s">'South Dakota'</span><span class="p">,</span>
        <span class="s">'TN'</span><span class="p">:</span> <span class="s">'Tennessee'</span><span class="p">,</span>
        <span class="s">'TX'</span><span class="p">:</span> <span class="s">'Texas'</span><span class="p">,</span>
        <span class="s">'UT'</span><span class="p">:</span> <span class="s">'Utah'</span><span class="p">,</span>
        <span class="s">'VA'</span><span class="p">:</span> <span class="s">'Virginia'</span><span class="p">,</span>
        <span class="s">'VT'</span><span class="p">:</span> <span class="s">'Vermont'</span><span class="p">,</span>
        <span class="s">'WA'</span><span class="p">:</span> <span class="s">'Washington'</span><span class="p">,</span>
        <span class="s">'WI'</span><span class="p">:</span> <span class="s">'Wisconsin'</span><span class="p">,</span>
        <span class="s">'WV'</span><span class="p">:</span> <span class="s">'West Virginia'</span><span class="p">,</span>
        <span class="s">'WY'</span><span class="p">:</span> <span class="s">'Wyoming'</span>
<span class="p">}</span>

<span class="c">#Create a list of state abbreviations</span>
<span class="n">state_abbrevs</span><span class="o">=</span><span class="p">[</span><span class="n">state</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">states</span><span class="p">]</span> 

<span class="c">#Create a list of state names</span>
<span class="n">state_names</span><span class="o">=</span><span class="p">[</span><span class="n">states</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">states</span><span class="p">]</span> 
</code></pre>
</div>

<p>For each tweet in our data frame, we can scan the location information to look for the state abbreviations or state names from our dictionary.  Some location information, such as “New York, NY” or “Alabama, New York” (yes, Alabama is a real city in New York) will contain multiple state names or abbreviations.  In this case, we’ll want to identify the second name or abbreviation that appears in the location information.  The one exception to this rule is users from “District of Columbia, Washington,” where we’ll want to use the first “state” name (District of Columbia) that appears.  Once we’ve extracted the state from the location information, we’ll add it to a new column in our data frame.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Function to determine the state that each tweet originated in</span>
<span class="k">def</span> <span class="nf">GetTweetState</span><span class="p">(</span><span class="n">dFrame</span><span class="p">):</span>
    
    <span class="c">#Get a list of all the tweet's locations from our dataframe</span>
    <span class="n">loc_list</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">dFrame</span><span class="p">[</span><span class="s">'location'</span><span class="p">])</span>
    
    <span class="n">state_list</span><span class="o">=</span><span class="p">[]</span>
    
    <span class="c">#Loop over the location info for each tweet</span>
    <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">loc_list</span><span class="p">:</span>
        
        <span class="c">#See if a state abbreviation or name is in the location information</span>
        <span class="n">new_state</span> <span class="o">=</span> <span class="p">[</span><span class="n">state</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">state_names</span> <span class="k">if</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span> <span class="o">+</span> \
                    <span class="p">[</span><span class="n">states</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">states</span> <span class="k">if</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>

        <span class="c">#Handle cases like "New York, NY" and "Alabama, New York"</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_state</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">new_state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">'District of Columbia'</span><span class="p">:</span>
            <span class="n">new_state</span> <span class="o">=</span> <span class="n">new_state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'junk'</span><span class="p">)</span>
            
        <span class="c">#Handle "District of Columbia, Washington"     </span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_state</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">new_state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">'District of Columbia'</span><span class="p">:</span>
            <span class="n">new_state</span> <span class="o">=</span> <span class="n">new_state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'junk'</span><span class="p">)</span>
            
        <span class="c">#Handle cases where no state is mentioned    </span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">new_state</span><span class="p">:</span>
            <span class="n">new_state</span> <span class="o">=</span> <span class="p">[</span><span class="s">'None'</span><span class="p">]</span>

        <span class="c">#After we determine the state, add it to a list</span>
        <span class="n">state_list</span><span class="o">+=</span><span class="n">new_state</span>
     
    <span class="c">#Once we have the entire list of states, add it to the dataframe</span>
    <span class="n">dFrame</span><span class="p">[</span><span class="s">'state'</span><span class="p">]</span><span class="o">=</span><span class="n">state_list</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">GetTweetState</span><span class="p">(</span><span class="n">PoGo_tweets</span><span class="p">)</span>
<span class="n">GetTweetState</span><span class="p">(</span><span class="n">PoGo_tweets_nosenti</span><span class="p">)</span>

<span class="n">PoGo_tweets</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</code></pre>
</div>

<div id="table-scroll">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>screenName</th>
      <th>userId</th>
      <th>text</th>
      <th>location</th>
      <th>multi-team</th>
      <th>sentiment</th>
      <th>repeatUser</th>
      <th>state</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>9434</th>
      <td>TheJakeTyler</td>
      <td>42497434.0</td>
      <td>#TeamMystic let's get it!!!!</td>
      <td>Virginia, USA</td>
      <td>False</td>
      <td>positive</td>
      <td>False</td>
      <td>Virginia</td>
    </tr>
    <tr>
      <th>9435</th>
      <td>LivAboveAverage</td>
      <td>333182239.0</td>
      <td>@AnthonyChott GO TEAM MYSTIC!!! #TeamMystic</td>
      <td>Chesterfield, MO</td>
      <td>False</td>
      <td>positive</td>
      <td>False</td>
      <td>Missouri</td>
    </tr>
    <tr>
      <th>9436</th>
      <td>TylerDurden919</td>
      <td>334394891.0</td>
      <td>10:45 Saturday morning, everyone's at @Bojangl...</td>
      <td>Durham, NC</td>
      <td>False</td>
      <td>positive</td>
      <td>False</td>
      <td>North Carolina</td>
    </tr>
  </tbody>
</table>
</div>

<h1 id="a-namedominancea-measuring-team-dominance-in-each-state"><a name="dominance"></a> Measuring team dominance in each state</h1>

<p>Now that we’ve identified the state each tweet is from, we can count how many tweets about each Pokemon Go team we collected in each state.  First, we initialize a new data frame with a row for each state.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#stateInfo and stateInfo_ns</span>
<span class="k">def</span> <span class="nf">MakeStateInfo</span><span class="p">(</span><span class="n">dFrame</span><span class="p">):</span>
    <span class="n">dFrame</span><span class="p">[</span><span class="s">'State'</span><span class="p">]</span><span class="o">=</span><span class="n">states</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Tweets'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Red'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Blue'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Yellow'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">stateInfo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">stateInfo_nosenti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="n">MakeStateInfo</span><span class="p">(</span><span class="n">stateInfo</span><span class="p">)</span>
<span class="n">MakeStateInfo</span><span class="p">(</span><span class="n">stateInfo_nosenti</span><span class="p">)</span>

<span class="n">stateInfo</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre>
</div>

<div id="table-scroll">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>State</th>
      <th>Num Tweets</th>
      <th>Num Red</th>
      <th>Num Blue</th>
      <th>Num Yellow</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Pennsylvania</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Delaware</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Nebraska</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Michigan</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Idaho</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<p>The <code class="highlighter-rouge">stateInfo</code> dataframe is indexed with numbers by default.  Since each row represents a state, it would be more convenient to use the state names as the index.  We can tell Pandas to do this using the <code class="highlighter-rouge">set_index</code> method.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">stateInfo</span> <span class="o">=</span> <span class="n">stateInfo</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s">'State'</span><span class="p">])</span>
<span class="n">stateInfo_nosenti</span> <span class="o">=</span> <span class="n">stateInfo_nosenti</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s">'State'</span><span class="p">])</span>

<span class="n">stateInfo</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre>
</div>

<div id="table-scroll">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Num Tweets</th>
      <th>Num Red</th>
      <th>Num Blue</th>
      <th>Num Yellow</th>
    </tr>
    <tr>
      <th>State</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Pennsylvania</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Delaware</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Nebraska</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Michigan</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Idaho</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<p>Now, we simply loop over each tweet in our collection.  For each tweet, we search for team-identifying phrases.  Once we’ve identified the team the tweet is referring to, we increase the count for that team in the corresponding state by one.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Lists of team identifying phrases</span>
<span class="n">yellow_text</span> <span class="o">=</span> <span class="p">[</span><span class="s">'#teaminstinct'</span><span class="p">,</span><span class="s">'#teamyellow'</span><span class="p">,</span><span class="s">'#instinct'</span><span class="p">,</span><span class="s">'team instinct'</span><span class="p">]</span>
<span class="n">blue_text</span> <span class="o">=</span> <span class="p">[</span><span class="s">'#teammystic'</span><span class="p">,</span><span class="s">'#teamblue'</span><span class="p">,</span><span class="s">'#mystic'</span><span class="p">,</span><span class="s">'team mystic'</span><span class="p">]</span>
<span class="n">red_text</span> <span class="o">=</span> <span class="p">[</span><span class="s">'#teamvalor'</span><span class="p">,</span><span class="s">'#teamred'</span><span class="p">,</span><span class="s">'#valor'</span><span class="p">,</span><span class="s">'team valor'</span><span class="p">]</span>

<span class="c">#Function to populate the stateInfo data frame</span>
<span class="k">def</span> <span class="nf">PopStateInfo</span><span class="p">(</span><span class="n">state_dFrame</span><span class="p">,</span><span class="n">tweet_dFrame</span><span class="p">):</span>
    
    <span class="c">#Loop over the tweet collection</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tweet_dFrame</span><span class="p">)):</span>
        
        <span class="c">#If we have state information for the tweet</span>
        <span class="k">if</span> <span class="n">tweet_dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="s">'state'</span><span class="p">]</span> <span class="o">!=</span> <span class="s">'None'</span><span class="p">:</span>
            
            <span class="c">#Search for the team identifying phrases and</span>
            <span class="c">#Add one count to that team in state where the tweet came from </span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">hashtag</span> <span class="ow">in</span> <span class="n">tweet_dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="s">'text'</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">yellow_text</span><span class="p">):</span>
                <span class="n">state_dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">tweet_dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="s">'state'</span><span class="p">],</span><span class="s">'Num Yellow'</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">hashtag</span> <span class="ow">in</span> <span class="n">tweet_dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="s">'text'</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">blue_text</span><span class="p">):</span>
                <span class="n">state_dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">tweet_dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="s">'state'</span><span class="p">],</span><span class="s">'Num Blue'</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">hashtag</span> <span class="ow">in</span> <span class="n">tweet_dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="s">'text'</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">red_text</span><span class="p">):</span>
                <span class="n">state_dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">tweet_dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="s">'state'</span><span class="p">],</span><span class="s">'Num Red'</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c">#After we've process all tweets</span>
    <span class="c">#Count all the tweets in each state by adding red + blue + yellow</span>
    <span class="n">state_dFrame</span><span class="p">[</span><span class="s">'Num Tweets'</span><span class="p">]</span> <span class="o">=</span> <span class="n">state_dFrame</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">PopStateInfo</span><span class="p">(</span><span class="n">stateInfo</span><span class="p">,</span><span class="n">PoGo_tweets</span><span class="p">)</span>
<span class="n">PopStateInfo</span><span class="p">(</span><span class="n">stateInfo_nosenti</span><span class="p">,</span><span class="n">PoGo_tweets_nosenti</span><span class="p">)</span>

<span class="n">stateInfo</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre>
</div>

<div id="table-scroll">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Num Tweets</th>
      <th>Num Red</th>
      <th>Num Blue</th>
      <th>Num Yellow</th>
    </tr>
    <tr>
      <th>State</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Pennsylvania</th>
      <td>275</td>
      <td>111</td>
      <td>97</td>
      <td>67</td>
    </tr>
    <tr>
      <th>Delaware</th>
      <td>27</td>
      <td>13</td>
      <td>7</td>
      <td>7</td>
    </tr>
    <tr>
      <th>Nebraska</th>
      <td>64</td>
      <td>26</td>
      <td>23</td>
      <td>15</td>
    </tr>
    <tr>
      <th>Michigan</th>
      <td>324</td>
      <td>123</td>
      <td>115</td>
      <td>86</td>
    </tr>
    <tr>
      <th>Idaho</th>
      <td>27</td>
      <td>11</td>
      <td>9</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div>

<p>Our metric for the dominance of each team in a state will simply be the fraction of tweets from that state that reference a particular team.  We can easily add this fraction to our data frame</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#Function to populate the stateInfo data frame</span>
<span class="k">def</span> <span class="nf">CalcDominance</span><span class="p">(</span><span class="n">dFrame</span><span class="p">):</span>
    <span class="n">dFrame</span><span class="p">[</span><span class="s">'R Frac'</span><span class="p">]</span><span class="o">=</span><span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Red'</span><span class="p">]</span><span class="o">/</span><span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Tweets'</span><span class="p">]</span>
    <span class="n">dFrame</span><span class="p">[</span><span class="s">'Y Frac'</span><span class="p">]</span><span class="o">=</span><span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Yellow'</span><span class="p">]</span><span class="o">/</span><span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Tweets'</span><span class="p">]</span>
    <span class="n">dFrame</span><span class="p">[</span><span class="s">'B Frac'</span><span class="p">]</span><span class="o">=</span><span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Blue'</span><span class="p">]</span><span class="o">/</span><span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Tweets'</span><span class="p">]</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">CalcDominance</span><span class="p">(</span><span class="n">stateInfo</span><span class="p">)</span>
<span class="n">CalcDominance</span><span class="p">(</span><span class="n">stateInfo_nosenti</span><span class="p">)</span>

<span class="n">stateInfo</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre>
</div>

<div id="table-scroll">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Num Tweets</th>
      <th>Num Red</th>
      <th>Num Blue</th>
      <th>Num Yellow</th>
      <th>R Frac</th>
      <th>Y Frac</th>
      <th>B Frac</th>
    </tr>
    <tr>
      <th>State</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Pennsylvania</th>
      <td>275</td>
      <td>111</td>
      <td>97</td>
      <td>67</td>
      <td>0.403636</td>
      <td>0.243636</td>
      <td>0.352727</td>
    </tr>
    <tr>
      <th>Delaware</th>
      <td>27</td>
      <td>13</td>
      <td>7</td>
      <td>7</td>
      <td>0.481481</td>
      <td>0.259259</td>
      <td>0.259259</td>
    </tr>
    <tr>
      <th>Nebraska</th>
      <td>64</td>
      <td>26</td>
      <td>23</td>
      <td>15</td>
      <td>0.406250</td>
      <td>0.234375</td>
      <td>0.359375</td>
    </tr>
    <tr>
      <th>Michigan</th>
      <td>324</td>
      <td>123</td>
      <td>115</td>
      <td>86</td>
      <td>0.379630</td>
      <td>0.265432</td>
      <td>0.354938</td>
    </tr>
    <tr>
      <th>Idaho</th>
      <td>27</td>
      <td>11</td>
      <td>9</td>
      <td>7</td>
      <td>0.407407</td>
      <td>0.259259</td>
      <td>0.333333</td>
    </tr>
  </tbody>
</table>
</div>

<h1 id="a-namestatsa-statistical-analysis-of-the-data"><a name="stats"></a> Statistical Analysis of the data</h1>

<p>In this section, I’ll discuss how to properly account for statistical and systematic errors in each of our tweet counts, and how to propagate those errors to our team dominance metric.  Along the way, I’ll also determine how many tweets are needed for our sentiment analyzer to improve the total error of our measurement.  I’ll provide hyperlinks that will detail the mathematical concepts we’ll be using, but without a strong understanding of statistics and calculus this section may be hard to follow.</p>

<h2 id="counting-statistics">Counting statistics</h2>

<p>In statistics, a <a href="https://www.pp.rhul.ac.uk/~cowan/stat/notes/PoissonNote.pdf">Poisson distribution</a> is used to describe the number of times an event occurs within a time interval.  This representation is appropriate if:</p>

<ul>
  <li>The number of times the event occurs (<script type="math/tex">\mathsf{N}</script>) in an interval is discrete (0,1,2,…)</li>
  <li>The event occurs independent of other events</li>
  <li>The rate at which events occur is approximately constant.</li>
  <li>The probability of events occurring at the same time is negligible.</li>
  <li>The probability of an event occurring in an interval is proportional to the length of the interval.</li>
</ul>

<p>The number of Pokemon Go tweets within each state meets all of the above conditions, so we can use the Poisson distribution to determine the statistical error on our measurement.  The standard deviation of a Poisson distribution is given by the square root of the number of events observed.  (A derivation of this can be found in the previous link.)  Therefore, the statistical error of the count of tweets (<script type="math/tex">\mathsf{N}</script>) is simply:</p>

<script type="math/tex; mode=display">\mathsf{ \sigma_{N,stat} = \sqrt{N} }\tag{1}</script>

<p>From our <a href="http://raknoche.github.io/2016/07/28/PoGo-Series-Sentiment-Analyzer/">last post</a>, we know that 8.92% of our tweet collection is contaminated with negative tweets when we do not apply our sentiment analyzer.  Once we apply our sentiment analyzer to remove negative tweets, this contamination falls to 2.4%.  We can treat the contamination of negative tweets as a systematic uncertainty on the number of tweets we count in each state:</p>

<script type="math/tex; mode=display">% <![CDATA[
\mathsf{ \sigma_{N, sys} = \begin{cases}
0.0892*N_{without \; analyzer}  & \text{if analyzer is not applied} \\
0.0240*N_{with \; analyzer} & \text{if analyzer is applied}
\end{cases} }\tag{2} %]]></script>

<p>Since the statistical and systematic errors on our tweet counts are uncorrelated, we can <a href="http://physics.stackexchange.com/questions/23441/how-to-combine-measurement-error-with-statistic-error">add them in quadrature</a> to find the total error on our tweet counts:</p>

<script type="math/tex; mode=display">% <![CDATA[
\mathsf{ \sigma_{N,tot} = \sqrt{ \sigma_{N,stat}^2 + \sigma_{N,sys}^2} = \begin{cases}
\sqrt{N_{without \; analyzer} + (0.0892*N_{without \; analyzer})^2}  & \text{if analyzer is not applied} \\
\sqrt{N_{with \; analyzer}+ (0.0240*N_{with \; analyzer})^2} & \text{if analyzer is applied}
\end{cases} }\tag{3} %]]></script>

<h2 id="when-is-our-sentiment-analysis-useful">When is our sentiment analysis useful?</h2>

<p>Now that we know how to calculate the total error on our tweet counts, we can determine how many tweets we need for our sentiment analyzer to be useful.  Applying our sentiment analyzer will lower the total number of tweets in our collection.  In turn, this will lower both the absolute statistical and systematic error of our measurement.  It’s important to realize that even though the absolute error on our tweet counts decreases as the total number of tweets decreases, the relative size of the error when compared to the number of tweets can still increase.  Instead, we must evaluate when our sentiment analyzer will lower the <a href="http://mathworld.wolfram.com/RelativeError.html">relative error</a> of our measurement.  That is, we need to determine when:</p>

<p><a name="eq4"></a>
<script type="math/tex">\mathsf{ \frac{ \sqrt{ N_{without \; analyzer} + 0.0892^2 * N_{without \; analyzer}^2 } } {N_{without \; analyzer}} \ge 
\frac{ \sqrt{ N_{with \; analyzer} + 0.0240^2 * N_{with \; analyzer}^2 } }{N_{with \; analyzer}} }\tag{4}</script></p>

<p>When we use our sentiment analyzer to reduce the number of negative tweets in our collection, any misclassified positive tweets will also be removed, and any misclassified negative tweets will remain.  Therefore, the number of remaining tweets after applying our sentiment analyzer is equal to:</p>

<p><a name="eq5"></a>
<script type="math/tex">\mathsf{ N_{with \; analyzer} = 0.0892*N_{without \;analyzer}*(1-R^-) + (1-0.0892)*N_{without \; analyzer}*R^+ = 0.732 * N_{without \;analyzer} }\tag{5}</script></p>

<p>Where I’ve used the fact that the negative recall of our classifier was <script type="math/tex">\mathsf{R^- = 0.789}</script>, and the positive recall of our classifier was <script type="math/tex">\mathsf{R^+=0.783}</script>.</p>

<p>Plugging <a href="#eq5">Equation 5</a> into <a href="#eq4">Equation 4</a> and simplifying yields the result that our classifier will improve the relative error on our measurement when</p>

<script type="math/tex; mode=display">\mathsf{ N_{without \; analyzer} \ge 50 }\tag{6}</script>

<h2 id="propagating-errors-to-our-team-dominance-metric">Propagating errors to our team dominance metric</h2>

<p>To make our team dominance map, we want to determine the fraction of tweets from each state that reference a particular team.  With the number of tweets about a team in a particular state given by <script type="math/tex">\mathsf{N_{team}}</script>, and the number of total tweets in that state given by <script type="math/tex">\mathsf{N_{state}}</script>, the dominance of a particular team in a state is given by:</p>

<script type="math/tex; mode=display">\mathsf{T \equiv Team \; Dominance =  \frac{N_{team}}{N_{state}} } \tag{6}</script>

<p>To determine the error on the team dominance measurement, we need to propagate the individual errors from the numerator and denominator.  The general equation for propagating the errors of numerous variables, <script type="math/tex">\mathsf{\mathbf{X} = \lbrace x_1,x_2,x_3,\dotsc,x_n \rbrace}</script>, to some function of those variables <script type="math/tex">\mathsf{F(\mathbf{X})}</script> is given by:</p>

<p><a name="eq7"></a>
<script type="math/tex">\mathsf{ \sigma_F ^2 = \sum_{i=1}^n \sigma_{x_i}^2 \left( \frac{ \delta F }{\delta x_i} \right)^2 + \sum_{i=1}^n \sum_{i \ne j}^n \sigma_{x_i,x_j}^2 \left( \frac{ \delta F }{\delta x_i} \right)\left( \frac{ \delta F }{\delta x_j} \right) }\tag{7}</script></p>

<p>where <script type="math/tex">\mathsf{\sigma_{x_i,x_j}^2}</script> is the covariance of the variables <script type="math/tex">\mathsf{x_i}</script> and <script type="math/tex">\mathsf{x_j}</script>.  In the case of uncorrelated variables, <script type="math/tex">\mathsf{\sigma_{x_i,x_j}^2 = 0}</script>, so the last term in <a href="#eq7">Equation 7</a> vanishes.</p>

<p>As it stands, the variables in our team dominance measurement, <script type="math/tex">\mathsf{N_{team}}</script> and <script type="math/tex">\mathsf{N_{state}}</script>, are correlated, since <script type="math/tex">\mathsf{N_{state}}</script> is equal to the sum of the tweet counts for each individual team.  To simplify our analysis, we can rewrite the team dominance equation in terms of the number of tweets referencing that team (<script type="math/tex">\mathsf{N_{team}}</script>) and the number of tweets referencing a different team (<script type="math/tex">\mathsf{N_{other}}</script>):</p>

<p><a name="eq8"></a>
<script type="math/tex">\mathsf{T =  \frac{N_{team}}{N_{team} + N_{other}} } \tag{8}</script></p>

<p><a href="#eq8">Equation 8</a> has no correlated variables, so we don’t need to worry about measuring the covariance of any terms when propagating error measurements.  Therefore, with the team dominance denoted as <script type="math/tex">\mathsf{T}</script>,</p>

<script type="math/tex; mode=display">\mathsf{ \sigma_T ^2 = \sigma_{N_{team},tot}^2 \left( \frac{ \delta T}{\delta N_{team}} \right)^2 + \sigma_{N_{other},tot}^2 \left( \frac{ \delta T }{\delta N_{other}} \right)^2 } \tag{9}</script>

<p>We can use the <a href="https://www.math.ucdavis.edu/~kouba/CalcOneDIRECTORY/productruledirectory/ProductRule.html">product rule</a> to calculate the partial derivative of <script type="math/tex">\mathsf{F}</script> with respect to <script type="math/tex">\mathsf{N_{team}}</script>:</p>

<script type="math/tex; mode=display">\mathsf{ \frac {\delta T}{\delta N_{team}} = \frac{N_{other}}{(N_{team} + N_{other})^2} } \tag{10}</script>

<p>Similarly, we can use the <a href="https://en.wikipedia.org/wiki/Chain_rule">chain rule</a> to calculate the partial derivative of <script type="math/tex">\mathsf{F}</script> with respect to <script type="math/tex">\mathsf{N_{other}}</script>:</p>

<script type="math/tex; mode=display">\mathsf{ \frac {\delta T}{\delta N_{other}} = \frac{-N_{team}}{(N_{team} + N_{other})^2} } \tag{11}</script>

<h2 id="statistical-analysis-code">Statistical Analysis Code</h2>

<p>Below, I’ve included the code that implements our statistical analysis.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">PopErrInfo</span><span class="p">(</span><span class="n">dFrame</span><span class="p">,</span><span class="n">sys_err</span><span class="p">):</span>
    
    <span class="c">#Systematic errors from negative tweet contamination</span>
    <span class="n">y_sys_err</span> <span class="o">=</span> <span class="n">sys_err</span><span class="o">*</span><span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Yellow'</span><span class="p">]</span>
    <span class="n">r_sys_err</span> <span class="o">=</span> <span class="n">sys_err</span><span class="o">*</span><span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Red'</span><span class="p">]</span>
    <span class="n">b_sys_err</span> <span class="o">=</span> <span class="n">sys_err</span><span class="o">*</span><span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Blue'</span><span class="p">]</span>

    <span class="c">#Statistical errors from Poisson counting</span>
    <span class="n">y_stat_err</span> <span class="o">=</span> <span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Yellow'</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">r_stat_err</span> <span class="o">=</span> <span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Red'</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">b_stat_err</span> <span class="o">=</span> <span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Blue'</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="c">#Total errors</span>
    <span class="n">y_tot_err</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_stat_err</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">y_sys_err</span> <span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">r_tot_err</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_stat_err</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">r_sys_err</span> <span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">b_tot_err</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_stat_err</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">b_sys_err</span> <span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>


    <span class="c">#Propagation of total errors to the team dominance metric</span>
    <span class="n">dFrame</span><span class="p">[</span><span class="s">'R Frac Err'</span><span class="p">]</span><span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="n">r_tot_err</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Blue'</span><span class="p">]</span> <span class="o">+</span> <span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Yellow'</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> \
                                <span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Red'</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">b_tot_err</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y_tot_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> \
                             <span class="p">(</span><span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Yellow'</span><span class="p">]</span> <span class="o">+</span> <span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Blue'</span><span class="p">]</span> <span class="o">+</span> <span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Red'</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>

    <span class="n">dFrame</span><span class="p">[</span><span class="s">'Y Frac Err'</span><span class="p">]</span><span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="n">y_tot_err</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Blue'</span><span class="p">]</span> <span class="o">+</span> <span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Red'</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> \
                                <span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Yellow'</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">b_tot_err</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">r_tot_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> \
                             <span class="p">(</span><span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Yellow'</span><span class="p">]</span> <span class="o">+</span> <span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Blue'</span><span class="p">]</span> <span class="o">+</span> <span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Red'</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>


    <span class="n">dFrame</span><span class="p">[</span><span class="s">'B Frac Err'</span><span class="p">]</span><span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="n">b_tot_err</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Yellow'</span><span class="p">]</span> <span class="o">+</span> <span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Red'</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> \
                                <span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Blue'</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_tot_err</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">r_tot_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> \
                             <span class="p">(</span><span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Yellow'</span><span class="p">]</span> <span class="o">+</span> <span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Blue'</span><span class="p">]</span> <span class="o">+</span> <span class="n">dFrame</span><span class="p">[</span><span class="s">'Num Red'</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>

</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">sys_err_nosenti</span><span class="o">=</span> <span class="mf">0.0892</span>
<span class="n">sys_err_senti</span>  <span class="o">=</span> <span class="mf">0.0240</span>

<span class="n">PopErrInfo</span><span class="p">(</span><span class="n">stateInfo</span><span class="p">,</span><span class="n">sys_err_senti</span><span class="p">)</span>
<span class="n">PopErrInfo</span><span class="p">(</span><span class="n">stateInfo_nosenti</span><span class="p">,</span><span class="n">sys_err_nosenti</span><span class="p">)</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">stateInfo</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre>
</div>

<div id="table-scroll">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Num Tweets</th>
      <th>Num Red</th>
      <th>Num Blue</th>
      <th>Num Yellow</th>
      <th>R Frac</th>
      <th>Y Frac</th>
      <th>B Frac</th>
      <th>R Frac Err</th>
      <th>Y Frac Err</th>
      <th>B Frac Err</th>
    </tr>
    <tr>
      <th>State</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Pennsylvania</th>
      <td>275</td>
      <td>111</td>
      <td>97</td>
      <td>67</td>
      <td>0.403636</td>
      <td>0.243636</td>
      <td>0.352727</td>
      <td>0.030429</td>
      <td>0.026448</td>
      <td>0.029600</td>
    </tr>
    <tr>
      <th>Delaware</th>
      <td>27</td>
      <td>13</td>
      <td>7</td>
      <td>7</td>
      <td>0.481481</td>
      <td>0.259259</td>
      <td>0.259259</td>
      <td>0.096439</td>
      <td>0.084531</td>
      <td>0.084531</td>
    </tr>
    <tr>
      <th>Nebraska</th>
      <td>64</td>
      <td>26</td>
      <td>23</td>
      <td>15</td>
      <td>0.406250</td>
      <td>0.234375</td>
      <td>0.359375</td>
      <td>0.061806</td>
      <td>0.053213</td>
      <td>0.060367</td>
    </tr>
    <tr>
      <th>Michigan</th>
      <td>324</td>
      <td>123</td>
      <td>115</td>
      <td>86</td>
      <td>0.379630</td>
      <td>0.265432</td>
      <td>0.354938</td>
      <td>0.027841</td>
      <td>0.025192</td>
      <td>0.027430</td>
    </tr>
    <tr>
      <th>Idaho</th>
      <td>27</td>
      <td>11</td>
      <td>9</td>
      <td>7</td>
      <td>0.407407</td>
      <td>0.259259</td>
      <td>0.333333</td>
      <td>0.094828</td>
      <td>0.084526</td>
      <td>0.090961</td>
    </tr>
  </tbody>
</table>
</div>

<p>Note that in a given state the number of tweets from one team may exceed 50 counts, while the number of tweets from a different team may not.  In this case, the sentiment analyzer would improve the error on our measurement for one team, but not for the other.  To resolve this ambiguity, I calculated the average relative error for each of our team dominance metrics.  I then added a new column to our data frames that indicated if the sentiment analysis improved the average relative error for each state.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#relative error = frac_err/frac</span>
<span class="k">def</span> <span class="nf">AverageRelErr</span><span class="p">(</span><span class="n">dFrame</span><span class="p">):</span>
    <span class="n">row_errs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dFrame</span><span class="p">)):</span> 
        <span class="n">rel_errs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'Y Frac'</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">rel_errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'Y Frac Err'</span><span class="p">]</span><span class="o">/</span><span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'Y Frac'</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'R Frac'</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">rel_errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'R Frac Err'</span><span class="p">]</span><span class="o">/</span><span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'R Frac'</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'B Frac'</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">rel_errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'B Frac Err'</span><span class="p">]</span><span class="o">/</span><span class="n">dFrame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'B Frac'</span><span class="p">])</span>

        <span class="n">row_errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">rel_errs</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">row_errs</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">stateInfo</span><span class="p">[</span><span class="s">'Average Rel Err'</span><span class="p">]</span><span class="o">=</span><span class="n">AverageRelErr</span><span class="p">(</span><span class="n">stateInfo</span><span class="p">)</span>
<span class="n">stateInfo_nosenti</span><span class="p">[</span><span class="s">'Average Rel Err'</span><span class="p">]</span><span class="o">=</span><span class="n">AverageRelErr</span><span class="p">(</span><span class="n">stateInfo_nosenti</span><span class="p">)</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">stateInfo</span><span class="p">[</span><span class="s">'Improved'</span><span class="p">]</span> <span class="o">=</span> <span class="n">stateInfo</span><span class="p">[</span><span class="s">'Average Rel Err'</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">stateInfo_nosenti</span><span class="p">[</span><span class="s">'Average Rel Err'</span><span class="p">]</span>
<span class="n">stateInfo</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre>
</div>

<div id="table-scroll">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Num Tweets</th>
      <th>Num Red</th>
      <th>Num Blue</th>
      <th>Num Yellow</th>
      <th>R Frac</th>
      <th>Y Frac</th>
      <th>B Frac</th>
      <th>R Frac Err</th>
      <th>Y Frac Err</th>
      <th>B Frac Err</th>
      <th>Average Rel Err</th>
      <th>Improved</th>
    </tr>
    <tr>
      <th>State</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Pennsylvania</th>
      <td>275</td>
      <td>111</td>
      <td>97</td>
      <td>67</td>
      <td>0.403636</td>
      <td>0.243636</td>
      <td>0.352727</td>
      <td>0.030429</td>
      <td>0.026448</td>
      <td>0.029600</td>
      <td>0.089287</td>
      <td>True</td>
    </tr>
    <tr>
      <th>Delaware</th>
      <td>27</td>
      <td>13</td>
      <td>7</td>
      <td>7</td>
      <td>0.481481</td>
      <td>0.259259</td>
      <td>0.259259</td>
      <td>0.096439</td>
      <td>0.084531</td>
      <td>0.084531</td>
      <td>0.284132</td>
      <td>False</td>
    </tr>
    <tr>
      <th>Nebraska</th>
      <td>64</td>
      <td>26</td>
      <td>23</td>
      <td>15</td>
      <td>0.406250</td>
      <td>0.234375</td>
      <td>0.359375</td>
      <td>0.061806</td>
      <td>0.053213</td>
      <td>0.060367</td>
      <td>0.182386</td>
      <td>False</td>
    </tr>
    <tr>
      <th>Michigan</th>
      <td>324</td>
      <td>123</td>
      <td>115</td>
      <td>86</td>
      <td>0.379630</td>
      <td>0.265432</td>
      <td>0.354938</td>
      <td>0.027841</td>
      <td>0.025192</td>
      <td>0.027430</td>
      <td>0.081843</td>
      <td>True</td>
    </tr>
    <tr>
      <th>Idaho</th>
      <td>27</td>
      <td>11</td>
      <td>9</td>
      <td>7</td>
      <td>0.407407</td>
      <td>0.259259</td>
      <td>0.333333</td>
      <td>0.094828</td>
      <td>0.084526</td>
      <td>0.090961</td>
      <td>0.277224</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>

<p>In the end, the sentiment analysis improved the average relative error of our team dominance measurement in the following states:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">stateInfo</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">stateInfo</span><span class="p">[</span><span class="s">'Improved'</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">]:</span>
    <span class="k">print</span> <span class="p">(</span><span class="n">state</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>Pennsylvania
Michigan
Alabama
Puerto Rico
California
Tennessee
Illinois
Nevada
North Carolina
South Dakota
Washington
Minnesota
Kentucky
Florida
Ohio
Indiana
Massachusetts
New Jersey
Texas
Oklahoma
Georgia
Arizona
Virginia
New York
Maryland
Oregon
</code></pre>
</div>

<p>Now that we’ve finished our statistical analysis, let’s save the data frames so that we can visualize the results in our <a href="http://raknoche.github.io/2016/08/03/PoGo-Series-Making-a-Choropleth-Map/">next and final blog post</a>.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">stateInfo</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'stateInfo.csv'</span><span class="p">)</span>
<span class="n">stateInfo_nosenti</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'stateInfo_nosenti.csv'</span><span class="p">)</span>
</code></pre>
</div>

  
  </div>
</div>


<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<div class="social-media">
    Share this: 
    <a class="social-media-box" href="https://twitter.com/intent/tweet?text=PoGo Series&#58; Statistical Analysis of Data&url=http://www.dealingdata.net/2016/07/31/PoGo-Series-Statistical-Analysis-of-the-Data/&via=&related=" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fa fa-twitter fa-sm-90"></i>Twitter</a>
    <a class="social-media-box" href="https://facebook.com/sharer.php?u=http://www.dealingdata.net/2016/07/31/PoGo-Series-Statistical-Analysis-of-the-Data/" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fa fa-facebook-f fa-sm-90"></i>Facebook</a>
    <a class="social-media-box" href="https://plus.google.com/share?url=http://www.dealingdata.net/2016/07/31/PoGo-Series-Statistical-Analysis-of-the-Data/" rel="nofollow" target="_blank" title="Share on Google+"><i class="fa fa-google-plus fa-sm-90"></i>Google+</a>
</div>


<div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    
    
    var disqus_config = function () {
        this.page.url = "http://dealingdata.net/2016/07/31/PoGo-Series-Statistical-Analysis-of-the-Data/";  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = "dealingdata.net/2016/07/31/PoGo-Series-Statistical-Analysis-of-the-Data/"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        
        s.src = '//dealingdata.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


                                  

      </div>
    </div>



  </body>
</html>
